<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Test">
    <meta name="Cesium-sandcastle-labels" content="Geometries">
    <title>SuperMap 模型单例显示</title>
    <script src="js/plotPanelControl/PlottingUI.Include.js"></script>
    <script type="text/javascript" src="../../Build/SuperMap3D/SuperMap3D.js"></script>
    <link href="../../Build/SuperMap3D/Widgets/widgets.css" rel="stylesheet">
    <script type="text/javascript" src="../../Build/SuperMap3D/ThirdParty/Workers/MGIS_SuperMap3D/MGIS_SuperMap3D.js"></script>
</head>

<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html"
    style="margin: 0px; overflow: hidden;background: #fff;height: 100%;">
    <div style="position: absolute;left:10px; top:20px;z-index: 1000;display:grid">
        <div>
            <label style="background-color:rgb(215, 223, 208);">开启单例模型的最小数量：</label>
            <input id="_layerModelMinCount" type="text" style="background-color:white" value="10000" />
        </div>
        &nbsp;&nbsp;
        <div>
            <label style="background-color:rgb(215, 223, 208);">模型数量：</label>
            <input id="_modelCount" type="text" style="background-color:white" value="9000" />
        </div>
        &nbsp;&nbsp;
        <div>
            <label style="background-color:rgb(215, 223, 208);">模型路径：</label>
            <input id="_modelPath" type="text" style="width:260px; background-color:white"
                value="./SampleData/situationSimulation/Model/RF-15/RF-15.gltf" />
        </div>
        &nbsp;&nbsp;
        <div>
            <input type="button" style="width:80px;background-color:rgb(215, 223, 208)" value="创建模型"
                onclick=" createModel()" />
            <input type="button" style="width:80px;background-color:rgb(215, 223, 208)" value="清空"
                onclick=" removeAll()" />
        </div>
        &nbsp;&nbsp;
    </div>
    <div id="SuperMap3DContainer" class="fullSize" style="position: relative;width: 100%;height: 100%;">
        <script id="SuperMap3D_sandcastle_script">

            var scene, viewer, serverUrl, plotting;
            var plottingLayer;
            let modelCounts = 9000;
            let modelPath = "./SampleData/situationSimulation/Model/RF-15/RF-15.gltf";

            function onload(SuperMap3D) {
                'use strict';
                if (window.Cesium) {
                    window.SuperMap3D = SuperMap3D;
                }
                //若本地没有标绘相关服务则可访问支持中心的iserver
                var host = window.isLocalPlot ? window.plotServer : "http://support.supermap.com.cn:8090";
                //var host = 'http://localhost:8090';
                viewer = new SuperMap3D.Viewer('SuperMap3DContainer');
                scene = viewer.scene;
                scene.globe.depthTestAgainstTerrain = true;
                scene.debugShowFramesPerSecond = true
                serverUrl = host + '/iserver/services/plot-jingyong/rest/plot';

                InitPlot(viewer, serverUrl);
            }

            function InitPlot(viewer, serverUrl) {
                if (!viewer) {
                    return;
                }

                plotting = SuperMap3D.Plotting.getInstance(serverUrl, scene);
                plottingLayer = new SuperMap3D.PlottingLayer(scene, "plottingLayer");
                scene.plotLayers.add(plottingLayer);
                plotting.setModelInstanceMinCount(10000);

                document.getElementById("_layerModelMinCount").addEventListener("input", setMinCount)
                document.getElementById("_modelCount").addEventListener("input", setModelCount)
                document.getElementById("_modelPath").addEventListener("input", setModelPath)
            }


            function createModel() {
                var libID = 0;
                var code = SuperMap3D.SymbolType.SYMBOL_MODEL;

                for (let i = 0; i < modelCounts; i++) {
                    let pt = getRandomPt();
                    var option = { url: modelPath };
                    plottingLayer.createSymbol(libID, code, [pt], option, function (event) {
                        event.feature.modelScale = 10000;
                    });
                }
            }

            function setModelCount(event) {
                let temp = parseInt(event.target.value);
                if (Number.isInteger(temp)) {
                    modelCounts = temp;
                }
            }

            function setModelPath(event) {
                modelPath = event.target.value;
            }

            function setMinCount(event) {
                let temp = parseInt(event.target.value);
                if (Number.isInteger(temp)) {
                    plotting.setModelInstanceMinCount(temp);
                }
            }

            //删除指定标号
            function deleteSeleGeo() {
                plottingLayer.removeGeoGraphicObject(plottingLayer.selectedFeature);
            }

            function removeAll() {
                plottingLayer.removeAll();
            }

            function getRandomPt() {
                // 0~180 -50~50
                let pt = new SuperMap3D.PlotPoint3D(Math.random() * 180, Math.random() * (50 + 50) - 50, 0);
                return pt;
            }

            if (typeof MGIS_SuperMap3D !== 'undefined') {
                window.startupCalled = true;
                onload(MGIS_SuperMap3D);
            }
        </script>
    </div>
</body>

</html>