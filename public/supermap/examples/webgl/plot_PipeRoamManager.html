<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Test">
    <meta name="sandcastle-labels" content="Geometries">
    <title>SuperMap 管线漫游</title>

    <script src="js/plotPanelControl/PlottingUI.Include.js"></script>
    <link href="../../Build/SuperMap3D/Widgets/widgets.css" rel="stylesheet">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link href="css/bootstrap-new.min.css" rel="stylesheet">
    <script type="text/javascript" src="js/widgets.js"></script>
    <script type="text/javascript" src="../../Build/SuperMap3D/SuperMap3D.js"></script>
    <script type="text/javascript" src="../../Build/SuperMap3D/ThirdParty/Workers/MGIS_SuperMap3D/MGIS_SuperMap3D.js"></script>
</head>

<body style=" margin: 0;background: #fff;width: 100%;height:100%;position: absolute;top: 0;">
    <div class="panel panel-primary"
    style="position: absolute;top: 10px;left: 10px;text-align: center;border-radius: 4px;height: 100px; border-width: 1px;solid: #3473b7;z-index: 9999;">
    <div class='panel-heading'>
        <h5 class='panel-title text-center'>管线自动漫游</h5>
    </div>
    <div class='panel-body content'>
        <input type="button" class="btn btn-default" value="管线选择" onclick="pipSelect()" />
        <input type="button" class="btn btn-default" value="起始结束位置选择" onclick="positionSelect()" />
        <input type="button" class="btn btn-default" value="管线漫游" onclick="pipeRoam()" />
        <input type="button" class="btn btn-default" value="漫游暂停" onclick="pause()" />
        <input type="button" class="btn btn-default" value="漫游停止" onclick="stop()" />
        <input type="button" class="btn btn-default" value="漫游复位" onclick="reset()" />
        <input type="button" class="btn btn-default" value="管线选择重置" onclick="allReset()" />
    </div>
</div>

    <div id="Container" class="fullSize" style="position: absolute;width: 100%;height: 100%;">
        <script id="_sandcastle_script">
            var plottingLayer;
            var scene;
            var viewer;
            var roamManager;
            function onload(MGIS_SuperMap3D) {
                'use strict';
                if (window.Cesium) {
                    window.SuperMap3D = MGIS_SuperMap3D;
                }
                var host = document.location.toString().match('/file:\/\//') ? 'http://localhost:8090' : 'http://' + document.location.host;
                var serverUrl = host + '/iserver/services/plot-jingyong/rest/plot';
                viewer = new SuperMap3D.Viewer('Container');
                scene = viewer.scene;
                let sceneUrl = host + "/iserver/services/3D-PipeRoam/rest/realspace";
                let dataUrl = host + "/iserver/services/data-PipeRoam/rest/data/featureResults.rjson?returnContent=true";
                var promise = scene.open(sceneUrl);

                promise.then((layers) => {
                    roamManager = SuperMap3D.PipAutomaticRoamManager.getInstance(viewer, { swipeDiv: "Container", pipDatasets: ["給水系統:ResultNetWork","給水系統:ResultNetWork_Node"], pipLayers: ["給水系統节点", "給水系統管线"], midPause: true, duration: 30, dataUrl:  dataUrl});
                    window.setInterval(function execute() {
                        roamManager.execute();
                    }, 5);
                })

            }

            function pipeRoam() {
                roamManager.play();

            }
            function pause() {
                roamManager.pause();
            }

            function stop() {
                roamManager.stop();
            }

            function reset() {
                roamManager.reset();
            }

            function pipSelect() {
                roamManager.activateSelectPipe();
            }

            function positionSelect() {
                roamManager.activateSelectPosition();
            }

            function allReset() {
                roamManager.clearAll();
            }

            if (typeof MGIS_SuperMap3D !== 'undefined') {
                window.startupCalled = true;
                onload(MGIS_SuperMap3D);
            }

        </script>
    </div>
</body>

</html>