<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>鼠标习惯</title>
    <link href="../../Build/SuperMap3D/Widgets/widgets.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet" >
    <link href="./css/pretty.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <link href="./style/MouseHabits.css" rel="stylesheet">
    <script src="./js/config.js"></script>
    <script src="./js/jquery.min.js" type="text/javascript" ></script>
    <script src="../../Build/SuperMap3D/SuperMap3D.js" type="text/javascript" ></script>
</head>

<body>
    <div id="Container"></div>
    <div id='loadingbar' class="spinner">
        <div class="spinner-container container1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
    </div>
    <div id='toolbar' style="position: absolute;left: 5px;top: 5px;">
        <div class="titleBox">
            <div class="titl">鼠标习惯</div>
            <span class="close2" aria-hidden="false">x</span>
        </div>

        <div class="inputBox" style="display: flex;">
            <label class="lab">操作模式</label>
            <div class="content radio-box">
                <div style="display: flex;flex-direction: row;margin-right: 28px;align-items: center;">
                    <input type="radio" name="displayType" value="0" id="rightZoom" checked>
                    <label for="rightZoom">中键旋转</label>
                </div>
                <div style="display: flex;flex-direction: row;margin-right: 28px;align-items: center;">
                    <input type="radio" name="displayType" value="1" id="rightRotate">
                    <label for="rightRotate">右键旋转</label>
                </div>
            </div>
        </div>

        <div class="inputBox">
            <label class="lab">步长缩放倍数</label>
            <div class="rangeBox">
                <input type="range" id="zoomFactor" min="1" max="15" value="5" step="1">
            </div>
            <input type="number" id="zoomFactor_input" min="1" max="15" value="5" style="color: #ffffff;margin-top: 3px;margin-left: 8px;">
        </div>
    </div>


    <script type="text/javascript">
        function onload(SuperMap3D) {
         // 通过config.js中的getEngineType,获取引擎类型（EngineType）用于设置启动方式
         const EngineType = getEngineType();
         const viewer = new SuperMap3D.Viewer('Container', {
             contextOptions: {
                 contextType: Number(EngineType), // Webgl2:2 ; WebGPU:3
             },
             timeline: false
         });

         viewer.scenePromise.then(function (scene) {
             init(SuperMap3D, scene, viewer);
         });
     }

     function init(SuperMap3D, scene, viewer) {
         window.viewer = viewer;
         viewer.resolutionScale = window.devicePixelRatio;
        
         // 加载高德影像地图
         viewer.imageryLayers.addImageryProvider(new SuperMap3D.UrlTemplateImageryProvider({
             url: 'https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}',
             minimumLevel: 3,
             maximumLevel: 18,
         }));

         const promise = viewer.scene.open(URL_CONFIG.SCENE_CBD);
         promise.then(function(layers){
             $('#loadingbar').remove();

             // 设置鼠标右键缩放
             $('#rightZoom').click(function () {
                 viewer.scene.screenSpaceCameraController.inverseTilt = false;
                 viewer.scene.screenSpaceCameraController.zoomEventTypes = [SuperMap3D.CameraEventType.RIGHT_DRAG, SuperMap3D.CameraEventType.WHEEL, SuperMap3D.CameraEventType.PINCH];
                 viewer.scene.screenSpaceCameraController.tiltEventTypes = [SuperMap3D.CameraEventType.MIDDLE_DRAG, SuperMap3D.CameraEventType.PINCH, {
                     eventType: SuperMap3D.CameraEventType.LEFT_DRAG,
                     modifier: SuperMap3D.KeyboardEventModifier.CTRL
                 }, {
                     eventType: SuperMap3D.CameraEventType.RIGHT_DRAG,
                     modifier: SuperMap3D.KeyboardEventModifier.CTRL
                 }];
             });

             // 设置鼠标右键俯仰
             $('#rightRotate').click(function () {
                 viewer.scene.screenSpaceCameraController.inverseTilt = true;
                 viewer.scene.screenSpaceCameraController.zoomEventTypes = [SuperMap3D.CameraEventType.WHEEL, SuperMap3D.CameraEventType.MIDDLE_DRAG];
                 viewer.scene.screenSpaceCameraController.tiltEventTypes = [SuperMap3D.CameraEventType.RIGHT_DRAG];
             });

             // 鼠标缩放速度
             $('#zoomFactor').mousemove(function () {
                 const factorNumber = $('#zoomFactor').val();
                 $('#zoomFactor_input').val(`${factorNumber}`);
                 viewer.scene.screenSpaceCameraController.zoomFactor = Number(factorNumber);
             });
             $('#zoomFactor_input').change(function () {
                 const factorNumber = Number($('#zoomFactor_input').val());
                 if(factorNumber<0 || factorNumber>15) return;
                 $('#zoomFactor').val(factorNumber);
                 viewer.scene.screenSpaceCameraController.zoomFactor = factorNumber;
             });
         })
     }
     if (typeof SuperMap3D !== 'undefined') {
         window.startupCalled = true;
         onload(SuperMap3D);
     }
 </script>
</body>

</html>