import{a as ar,b as nr}from"./chunk-NYIUPUGD.js";import{a as Ue}from"./chunk-G5JLXMFE.js";import{a as er}from"./chunk-AMRCVYIA.js";import{a as ir}from"./chunk-SFEFACN7.js";import{a as rr}from"./chunk-L6Z5JM56.js";import"./chunk-RMFPWQ3G.js";import"./chunk-4XC5RTMX.js";import"./chunk-Q4ZRVZUS.js";import"./chunk-KBENTI6G.js";import"./chunk-L77WLOIG.js";import{f as Pe}from"./chunk-T3RVX7V2.js";import"./chunk-NPAFDOYL.js";import{c as $e}from"./chunk-YOUPUNCB.js";import"./chunk-ZIZDQ7PT.js";import"./chunk-QO3RRUEO.js";import{a as Ie}from"./chunk-RRHLFRBE.js";import"./chunk-SRPTWKHW.js";import{a as Re}from"./chunk-6S43R6PL.js";import"./chunk-GMH62RQ6.js";import"./chunk-6NA2GRXE.js";import"./chunk-JTWCWMT6.js";import"./chunk-NBA64YIR.js";import"./chunk-EHDXVZQM.js";import{a as me}from"./chunk-3CEYC7M5.js";import{a as Ke,b as pe}from"./chunk-SVO3L3ZS.js";import"./chunk-ZCGLU37G.js";import"./chunk-E37TXANJ.js";import{a as ee}from"./chunk-DJQWO2NJ.js";import{a as ve}from"./chunk-Y2ETSBLW.js";import{a as z}from"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as ue}from"./chunk-PJGSCWXZ.js";import{a as W}from"./chunk-NUC3LT2W.js";import{b as Ir,c as Ur}from"./chunk-SFC4FDPW.js";var sr=Ir((qr,xe)=>{/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var S=function(){var A={};A.defaultNoDataValue=-34027999387901484e22,A.decode=function(r,t){t=t||{};var a=t.encodedMaskData||t.encodedMaskData===null,i=n(r,t.inputOffset||0,a),s=t.noDataValue!==null?t.noDataValue:A.defaultNoDataValue,f=D(i,t.pixelType||Float32Array,t.encodedMaskData,s,t.returnMask),v={width:i.width,height:i.height,pixelData:f.resultPixels,minValue:f.minValue,maxValue:i.pixels.maxValue,noDataValue:s};return f.resultMask&&(v.maskData=f.resultMask),t.returnEncodedMask&&i.mask&&(v.encodedMaskData=i.mask.bitset?i.mask.bitset:null),t.returnFileInfo&&(v.fileInfo=C(i),t.computeUsedBitDepths&&(v.fileInfo.bitDepths=_(i))),v};var D=function(r,t,a,i,s){var f=0,v=r.pixels.numBlocksX,m=r.pixels.numBlocksY,o=Math.floor(r.width/v),l=Math.floor(r.height/m),h=2*r.maxZError,u=Number.MAX_VALUE,c;a=a||(r.mask?r.mask.bitset:null);var g,x;g=new t(r.width*r.height),s&&a&&(x=new Uint8Array(r.width*r.height));for(var T=new Float32Array(o*l),V,I,M=0;M<=m;M++){var d=M!==m?l:r.height%m;if(d!==0)for(var w=0;w<=v;w++){var U=w!==v?o:r.width%v;if(U!==0){var k=M*r.width*l+w*o,y=r.width-U,p=r.pixels.blocks[f],B,F,L;p.encoding<2?(p.encoding===0?B=p.rawData:(e(p.stuffedData,p.bitsPerPixel,p.numValidPixels,p.offset,h,T,r.pixels.maxValue),B=T),F=0):p.encoding===2?L=0:L=p.offset;var N;if(a)for(I=0;I<d;I++){for(k&7&&(N=a[k>>3],N<<=k&7),V=0;V<U;V++)k&7||(N=a[k>>3]),N&128?(x&&(x[k]=1),c=p.encoding<2?B[F++]:L,u=u>c?c:u,g[k++]=c):(x&&(x[k]=0),g[k++]=i),N<<=1;k+=y}else if(p.encoding<2)for(I=0;I<d;I++){for(V=0;V<U;V++)c=B[F++],u=u>c?c:u,g[k++]=c;k+=y}else for(u=u>L?L:u,I=0;I<d;I++){for(V=0;V<U;V++)g[k++]=L;k+=y}if(p.encoding===1&&F!==p.numValidPixels)throw"Block and Mask do not match";f++}}}return{resultPixels:g,resultMask:x,minValue:u}},C=function(r){return{fileIdentifierString:r.fileIdentifierString,fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,noDataValue:r.noDataValue}}},_=function(r){for(var t=r.pixels.numBlocksX*r.pixels.numBlocksY,a={},i=0;i<t;i++){var s=r.pixels.blocks[i];s.encoding===0?a.float32=!0:s.encoding===1?a[s.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},n=function(r,t,a){var i={},s=new Uint8Array(r,t,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,s),i.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+i.fileIdentifierString;t+=10;var f=new DataView(r,t,24);if(i.fileVersion=f.getInt32(0,!0),i.imageType=f.getInt32(4,!0),i.height=f.getUint32(8,!0),i.width=f.getUint32(12,!0),i.maxZError=f.getFloat64(16,!0),t+=24,!a)if(f=new DataView(r,t,16),i.mask={},i.mask.numBlocksY=f.getUint32(0,!0),i.mask.numBlocksX=f.getUint32(4,!0),i.mask.numBytes=f.getUint32(8,!0),i.mask.maxValue=f.getFloat32(12,!0),t+=16,i.mask.numBytes>0){var v=new Uint8Array(Math.ceil(i.width*i.height/8));f=new DataView(r,t,i.mask.numBytes);var m=f.getInt16(0,!0),o=2,l=0;do{if(m>0)for(;m--;)v[l++]=f.getUint8(o++);else{var h=f.getUint8(o++);for(m=-m;m--;)v[l++]=h}m=f.getInt16(o,!0),o+=2}while(o<i.mask.numBytes);if(m!==-32768||l<v.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=v,t+=i.mask.numBytes}else(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)===0&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));f=new DataView(r,t,16),i.pixels={},i.pixels.numBlocksY=f.getUint32(0,!0),i.pixels.numBlocksX=f.getUint32(4,!0),i.pixels.numBytes=f.getUint32(8,!0),i.pixels.maxValue=f.getFloat32(12,!0),t+=16;var u=i.pixels.numBlocksX,c=i.pixels.numBlocksY,g=u+(i.width%u>0?1:0),x=c+(i.height%c>0?1:0);i.pixels.blocks=new Array(g*x);for(var T=0,V=0;V<x;V++)for(var I=0;I<g;I++){var M=0,d=r.byteLength-t;f=new DataView(r,t,Math.min(10,d));var w={};i.pixels.blocks[T++]=w;var U=f.getUint8(0);if(M++,w.encoding=U&63,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(w.encoding===2){t++;continue}if(U!==0&&U!==2){if(U>>=6,w.offsetType=U,U===2)w.offset=f.getInt8(1),M++;else if(U===1)w.offset=f.getInt16(1,!0),M+=2;else if(U===0)w.offset=f.getFloat32(1,!0),M+=4;else throw"Invalid block offset type";if(w.encoding===1)if(U=f.getUint8(M),M++,w.bitsPerPixel=U&63,U>>=6,w.numValidPixelsType=U,U===2)w.numValidPixels=f.getUint8(M),M++;else if(U===1)w.numValidPixels=f.getUint16(M,!0),M+=2;else if(U===0)w.numValidPixels=f.getUint32(M,!0),M+=4;else throw"Invalid valid pixel count type"}if(t+=M,w.encoding!==3){var k,y;if(w.encoding===0){var p=(i.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";k=new ArrayBuffer(p*4),y=new Uint8Array(k),y.set(new Uint8Array(r,t,p*4));var B=new Float32Array(k);w.rawData=B,t+=p*4}else if(w.encoding===1){var F=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),L=Math.ceil(F/4);k=new ArrayBuffer(L*4),y=new Uint8Array(k),y.set(new Uint8Array(r,t,F)),w.stuffedData=new Uint32Array(k),t+=F}}}return i.eofOffset=t,i},e=function(r,t,a,i,s,f,v){var m=(1<<t)-1,o=0,l,h=0,u,c,g=Math.ceil((v-i)/s),x=r.length*4-Math.ceil(t*a/8);for(r[r.length-1]<<=8*x,l=0;l<a;l++){if(h===0&&(c=r[o++],h=32),h>=t)u=c>>>h-t&m,h-=t;else{var T=t-h;u=(c&m)<<T&m,c=r[o++],h=32-T,u+=c>>>h}f[l]=u<g?i+u*s:v}return f};return A}(),ne=function(){"use strict";var A={unstuff:function(n,e,r,t,a,i,s,f){var v=(1<<r)-1,m=0,o,l=0,h,u,c,g,x=n.length*4-Math.ceil(r*t/8);if(n[n.length-1]<<=8*x,a)for(o=0;o<t;o++)l===0&&(u=n[m++],l=32),l>=r?(h=u>>>l-r&v,l-=r):(c=r-l,h=(u&v)<<c&v,u=n[m++],l=32-c,h+=u>>>l),e[o]=a[h];else for(g=Math.ceil((f-i)/s),o=0;o<t;o++)l===0&&(u=n[m++],l=32),l>=r?(h=u>>>l-r&v,l-=r):(c=r-l,h=(u&v)<<c&v,u=n[m++],l=32-c,h+=u>>>l),e[o]=h<g?i+h*s:f},unstuffLUT:function(n,e,r,t,a,i){var s=(1<<e)-1,f=0,v=0,m=0,o=0,l=0,h,u=[],c=n.length*4-Math.ceil(e*r/8);n[n.length-1]<<=8*c;var g=Math.ceil((i-t)/a);for(v=0;v<r;v++)o===0&&(h=n[f++],o=32),o>=e?(l=h>>>o-e&s,o-=e):(m=e-o,l=(h&s)<<m&s,h=n[f++],o=32-m,l+=h>>>o),u[v]=l<g?t+l*a:i;return u.unshift(t),u},unstuff2:function(n,e,r,t,a,i,s,f){var v=(1<<r)-1,m=0,o,l=0,h=0,u,c,g;if(a)for(o=0;o<t;o++)l===0&&(c=n[m++],l=32,h=0),l>=r?(u=c>>>h&v,l-=r,h+=r):(g=r-l,u=c>>>h&v,c=n[m++],l=32-g,u|=(c&(1<<g)-1)<<r-g,h=g),e[o]=a[u];else{var x=Math.ceil((f-i)/s);for(o=0;o<t;o++)l===0&&(c=n[m++],l=32,h=0),l>=r?(u=c>>>h&v,l-=r,h+=r):(g=r-l,u=c>>>h&v,c=n[m++],l=32-g,u|=(c&(1<<g)-1)<<r-g,h=g),e[o]=u<x?i+u*s:f}return e},unstuffLUT2:function(n,e,r,t,a,i){var s=(1<<e)-1,f=0,v=0,m=0,o=0,l=0,h=0,u,c=[],g=Math.ceil((i-t)/a);for(v=0;v<r;v++)o===0&&(u=n[f++],o=32,h=0),o>=e?(l=u>>>h&s,o-=e,h+=e):(m=e-o,l=u>>>h&s,u=n[f++],o=32-m,l|=(u&(1<<m)-1)<<e-m,h=m),c[v]=l<g?t+l*a:i;return c.unshift(t),c},originalUnstuff:function(n,e,r,t){var a=(1<<r)-1,i=0,s,f=0,v,m,o,l=n.length*4-Math.ceil(r*t/8);for(n[n.length-1]<<=8*l,s=0;s<t;s++)f===0&&(m=n[i++],f=32),f>=r?(v=m>>>f-r&a,f-=r):(o=r-f,v=(m&a)<<o&a,m=n[i++],f=32-o,v+=m>>>f),e[s]=v;return e},originalUnstuff2:function(n,e,r,t){var a=(1<<r)-1,i=0,s,f=0,v=0,m,o,l;for(s=0;s<t;s++)f===0&&(o=n[i++],f=32,v=0),f>=r?(m=o>>>v&a,f-=r,v+=r):(l=r-f,m=o>>>v&a,o=n[i++],f=32-l,m|=(o&(1<<l)-1)<<r-l,v=l),e[s]=m;return e}},D={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(n){for(var e=65535,r=65535,t=n.length,a=Math.floor(t/2),i=0;a;){var s=a>=359?359:a;a-=s;do e+=n[i++]<<8,r+=e+=n[i++];while(--s);e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16)}return t&1&&(r+=e+=n[i]<<8),e=(e&65535)+(e>>>16),r=(r&65535)+(r>>>16),(r<<16|e)>>>0},readHeaderInfo:function(n,e){var r=e.ptr,t=new Uint8Array(n,r,6),a={};if(a.fileIdentifierString=String.fromCharCode.apply(null,t),a.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;r+=6;var i=new DataView(n,r,8),s=i.getInt32(0,!0);a.fileVersion=s,r+=4,s>=3&&(a.checksum=i.getUint32(4,!0),r+=4),i=new DataView(n,r,12),a.height=i.getUint32(0,!0),a.width=i.getUint32(4,!0),r+=8,s>=4?(a.numDims=i.getUint32(8,!0),r+=4):a.numDims=1,i=new DataView(n,r,40),a.numValidPixel=i.getUint32(0,!0),a.microBlockSize=i.getInt32(4,!0),a.blobSize=i.getInt32(8,!0),a.imageType=i.getInt32(12,!0),a.maxZError=i.getFloat64(16,!0),a.zMin=i.getFloat64(24,!0),a.zMax=i.getFloat64(32,!0),r+=40,e.headerInfo=a,e.ptr=r;var f,v;if(s>=3&&(v=s>=4?52:48,f=this.computeChecksumFletcher32(new Uint8Array(n,r-v,a.blobSize-14)),f!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(n,e){var r=e.headerInfo,t=this.getDataTypeArray(r.imageType),a=r.numDims*this.getDataTypeSize(r.imageType),i=this.readSubArray(n,e.ptr,t,a),s=this.readSubArray(n,e.ptr+a,t,a);e.ptr+=2*a;var f,v=!0;for(f=0;f<r.numDims;f++)if(i[f]!==s[f]){v=!1;break}return r.minValues=i,r.maxValues=s,v},readSubArray:function(n,e,r,t){var a;if(r===Uint8Array)a=new Uint8Array(n,e,t);else{var i=new ArrayBuffer(t),s=new Uint8Array(i);s.set(new Uint8Array(n,e,t)),a=new r(i)}return a},readMask:function(n,e){var r=e.ptr,t=e.headerInfo,a=t.width*t.height,i=t.numValidPixel,s=new DataView(n,r,4),f={};if(f.numBytes=s.getUint32(0,!0),r+=4,(i===0||a===i)&&f.numBytes!==0)throw"invalid mask";var v,m;if(i===0)v=new Uint8Array(Math.ceil(a/8)),f.bitset=v,m=new Uint8Array(a),e.pixels.resultMask=m,r+=f.numBytes;else if(f.numBytes>0){v=new Uint8Array(Math.ceil(a/8)),s=new DataView(n,r,f.numBytes);var o=s.getInt16(0,!0),l=2,h=0,u=0;do{if(o>0)for(;o--;)v[h++]=s.getUint8(l++);else for(u=s.getUint8(l++),o=-o;o--;)v[h++]=u;o=s.getInt16(l,!0),l+=2}while(l<f.numBytes);if(o!==-32768||h<v.length)throw"Unexpected end of mask RLE encoding";m=new Uint8Array(a);var c=0,g=0;for(g=0;g<a;g++)g&7?(c=v[g>>3],c<<=g&7):c=v[g>>3],c&128&&(m[g]=1);e.pixels.resultMask=m,f.bitset=v,r+=f.numBytes}return e.ptr=r,e.mask=f,!0},readDataOneSweep:function(n,e,r){var t=e.ptr,a=e.headerInfo,i=a.numDims,s=a.width*a.height,f=a.imageType,v=a.numValidPixel*D.getDataTypeSize(f)*i,m,o=e.pixels.resultMask;if(r===Uint8Array)m=new Uint8Array(n,t,v);else{var l=new ArrayBuffer(v),h=new Uint8Array(l);h.set(new Uint8Array(n,t,v)),m=new r(l)}if(m.length===s*i)e.pixels.resultPixels=m;else{e.pixels.resultPixels=new r(s*i);var u=0,c=0,g=0,x=0;if(i>1)for(g=0;g<i;g++)for(x=g*s,c=0;c<s;c++)o[c]&&(e.pixels.resultPixels[x+c]=m[u++]);else for(c=0;c<s;c++)o[c]&&(e.pixels.resultPixels[c]=m[u++])}return t+=v,e.ptr=t,!0},readHuffmanTree:function(n,e){var r=this.HUFFMAN_LUT_BITS_MAX,t=new DataView(n,e.ptr,16);e.ptr+=16;var a=t.getInt32(0,!0);if(a<2)throw"unsupported Huffman version";var i=t.getInt32(4,!0),s=t.getInt32(8,!0),f=t.getInt32(12,!0);if(s>=f)return!1;var v=new Uint32Array(f-s);D.decodeBits(n,e,v);var m=[],o,l,h,u;for(o=s;o<f;o++)l=o-(o<i?0:i),m[l]={first:v[o-s],second:null};var c=n.byteLength-e.ptr,g=Math.ceil(c/4),x=new ArrayBuffer(g*4),T=new Uint8Array(x);T.set(new Uint8Array(n,e.ptr,c));var V=new Uint32Array(x),I=0,M,d=0;for(M=V[0],o=s;o<f;o++)l=o-(o<i?0:i),u=m[l].first,u>0&&(m[l].second=M<<I>>>32-u,32-I>=u?(I+=u,I===32&&(I=0,d++,M=V[d])):(I+=u-32,d++,M=V[d],m[l].second|=M>>>32-I));var w=0,U=0,k=new C;for(o=0;o<m.length;o++)m[o]!==void 0&&(w=Math.max(w,m[o].first));w>=r?U=r:U=w,w>=30&&console.log("WARning, large NUM LUT BITS IS "+w);var y=[],p,B,F,L,N,b;for(o=s;o<f;o++)if(l=o-(o<i?0:i),u=m[l].first,u>0)if(p=[u,l],u<=U)for(B=m[l].second<<U-u,F=1<<U-u,h=0;h<F;h++)y[B|h]=p;else for(B=m[l].second,b=k,L=u-1;L>=0;L--)N=B>>>L&1,N?(b.right||(b.right=new C),b=b.right):(b.left||(b.left=new C),b=b.left),L===0&&!b.val&&(b.val=p[1]);return{decodeLut:y,numBitsLUTQick:U,numBitsLUT:w,tree:k,stuffedData:V,srcPtr:d,bitPos:I}},readHuffman:function(n,e,r){var t=e.headerInfo,a=t.numDims,i=e.headerInfo.height,s=e.headerInfo.width,f=s*i,v=this.readHuffmanTree(n,e),m=v.decodeLut,o=v.tree,l=v.stuffedData,h=v.srcPtr,u=v.bitPos,c=v.numBitsLUTQick,g=v.numBitsLUT,x=e.headerInfo.imageType===0?128:0,T,V,I,M=e.pixels.resultMask,d,w,U,k,y,p,B,F=0;u>0&&(h++,u=0);var L=l[h],N=e.encodeMode===1,b=new r(f*a),E=b,H;for(H=0;H<t.numDims;H++){if(a>1&&(E=new r(b.buffer,f*H,f),F=0),e.headerInfo.numValidPixel===s*i)for(p=0,k=0;k<i;k++)for(y=0;y<s;y++,p++){if(V=0,d=L<<u>>>32-c,w=d,32-u<c&&(d|=l[h+1]>>>64-u-c,w=d),m[w])V=m[w][1],u+=m[w][0];else for(d=L<<u>>>32-g,w=d,32-u<g&&(d|=l[h+1]>>>64-u-g,w=d),T=o,B=0;B<g;B++)if(U=d>>>g-B-1&1,T=U?T.right:T.left,!(T.left||T.right)){V=T.val,u=u+B+1;break}u>=32&&(u-=32,h++,L=l[h]),I=V-x,N?(y>0?I+=F:k>0?I+=E[p-s]:I+=F,I&=255,E[p]=I,F=I):E[p]=I}else for(p=0,k=0;k<i;k++)for(y=0;y<s;y++,p++)if(M[p]){if(V=0,d=L<<u>>>32-c,w=d,32-u<c&&(d|=l[h+1]>>>64-u-c,w=d),m[w])V=m[w][1],u+=m[w][0];else for(d=L<<u>>>32-g,w=d,32-u<g&&(d|=l[h+1]>>>64-u-g,w=d),T=o,B=0;B<g;B++)if(U=d>>>g-B-1&1,T=U?T.right:T.left,!(T.left||T.right)){V=T.val,u=u+B+1;break}u>=32&&(u-=32,h++,L=l[h]),I=V-x,N?(y>0&&M[p-1]?I+=F:k>0&&M[p-s]?I+=E[p-s]:I+=F,I&=255,E[p]=I,F=I):E[p]=I}e.ptr=e.ptr+(h+1)*4+(u>0?4:0)}e.pixels.resultPixels=b},decodeBits:function(n,e,r,t,a){{var i=e.headerInfo,s=i.fileVersion,f=0,v=new DataView(n,e.ptr,5),m=v.getUint8(0);f++;var o=m>>6,l=o===0?4:3-o,h=(m&32)>0,u=m&31,c=0;if(l===1)c=v.getUint8(f),f++;else if(l===2)c=v.getUint16(f,!0),f+=2;else if(l===4)c=v.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";var g=2*i.maxZError,x,T,V,I,M,d,w,U,k,y,p=i.numDims>1?i.maxValues[a]:i.zMax;if(h){for(e.counter.lut++,U=v.getUint8(f),k=u,f++,I=Math.ceil((U-1)*u/8),M=Math.ceil(I/4),T=new ArrayBuffer(M*4),V=new Uint8Array(T),e.ptr+=f,V.set(new Uint8Array(n,e.ptr,I)),w=new Uint32Array(T),e.ptr+=I,y=0;U-1>>>y;)y++;I=Math.ceil(c*y/8),M=Math.ceil(I/4),T=new ArrayBuffer(M*4),V=new Uint8Array(T),V.set(new Uint8Array(n,e.ptr,I)),x=new Uint32Array(T),e.ptr+=I,s>=3?d=A.unstuffLUT2(w,u,U-1,t,g,p):d=A.unstuffLUT(w,u,U-1,t,g,p),s>=3?A.unstuff2(x,r,y,c,d):A.unstuff(x,r,y,c,d)}else e.counter.bitstuffer++,y=u,e.ptr+=f,y>0&&(I=Math.ceil(c*y/8),M=Math.ceil(I/4),T=new ArrayBuffer(M*4),V=new Uint8Array(T),V.set(new Uint8Array(n,e.ptr,I)),x=new Uint32Array(T),e.ptr+=I,s>=3?t==null?A.originalUnstuff2(x,r,y,c):A.unstuff2(x,r,y,c,!1,t,g,p):t==null?A.originalUnstuff(x,r,y,c):A.unstuff(x,r,y,c,!1,t,g,p))}},readTiles:function(n,e,r){var t=e.headerInfo,a=t.width,i=t.height,s=t.microBlockSize,f=t.imageType,v=D.getDataTypeSize(f),m=Math.ceil(a/s),o=Math.ceil(i/s);e.pixels.numBlocksY=o,e.pixels.numBlocksX=m,e.pixels.ptr=0;var l=0,h=0,u=0,c=0,g=0,x=0,T=0,V=0,I=0,M=0,d=0,w=0,U=0,k=0,y=0,p=0,B,F,L,N,b,E,H=new r(s*s),he=i%s||s,Te=a%s||s,ie,ae,G=t.numDims,Y,q=e.pixels.resultMask,O=e.pixels.resultPixels;for(u=0;u<o;u++)for(g=u!==o-1?s:he,c=0;c<m;c++)for(x=c!==m-1?s:Te,d=u*a*s+c*s,w=a-x,Y=0;Y<G;Y++){if(G>1&&(O=new r(e.pixels.resultPixels.buffer,a*i*Y*v,a*i)),T=n.byteLength-e.ptr,B=new DataView(n,e.ptr,Math.min(10,T)),F={},p=0,V=B.getUint8(0),p++,I=V>>6&255,M=V>>2&15,M!==(c*s>>3&15))throw"integrity issue";if(E=V&3,E>3)throw e.ptr+=p,"Invalid block encoding ("+E+")";if(E===2){e.counter.constant++,e.ptr+=p;continue}else if(E===0){if(e.counter.uncompressed++,e.ptr+=p,U=g*x*v,k=n.byteLength-e.ptr,U=U<k?U:k,L=new ArrayBuffer(U%v===0?U:U+v-U%v),N=new Uint8Array(L),N.set(new Uint8Array(n,e.ptr,U)),b=new r(L),y=0,q)for(l=0;l<g;l++){for(h=0;h<x;h++)q[d]&&(O[d]=b[y++]),d++;d+=w}else for(l=0;l<g;l++){for(h=0;h<x;h++)O[d++]=b[y++];d+=w}e.ptr+=y*v}else if(ie=D.getDataTypeUsed(f,I),ae=D.getOnePixel(F,p,ie,B),p+=D.getDataTypeSize(ie),E===3)if(e.ptr+=p,e.counter.constantoffset++,q)for(l=0;l<g;l++){for(h=0;h<x;h++)q[d]&&(O[d]=ae),d++;d+=w}else for(l=0;l<g;l++){for(h=0;h<x;h++)O[d++]=ae;d+=w}else if(e.ptr+=p,D.decodeBits(n,e,H,ae,Y),p=0,q)for(l=0;l<g;l++){for(h=0;h<x;h++)q[d]&&(O[d]=H[p++]),d++;d+=w}else for(l=0;l<g;l++){for(h=0;h<x;h++)O[d++]=H[p++];d+=w}}},formatFileInfo:function(n){return{fileIdentifierString:n.headerInfo.fileIdentifierString,fileVersion:n.headerInfo.fileVersion,imageType:n.headerInfo.imageType,height:n.headerInfo.height,width:n.headerInfo.width,numValidPixel:n.headerInfo.numValidPixel,microBlockSize:n.headerInfo.microBlockSize,blobSize:n.headerInfo.blobSize,maxZError:n.headerInfo.maxZError,pixelType:D.getPixelType(n.headerInfo.imageType),eofOffset:n.eofOffset,mask:n.mask?{numBytes:n.mask.numBytes}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,maxValue:n.headerInfo.zMax,minValue:n.headerInfo.zMin,noDataValue:n.noDataValue}}},constructConstantSurface:function(n){var e=n.headerInfo.zMax,r=n.headerInfo.numDims,t=n.headerInfo.height*n.headerInfo.width,a=t*r,i=0,s=0,f=0,v=n.pixels.resultMask;if(v)if(r>1)for(i=0;i<r;i++)for(f=i*t,s=0;s<t;s++)v[s]&&(n.pixels.resultPixels[f+s]=e);else for(s=0;s<t;s++)v[s]&&(n.pixels.resultPixels[s]=e);else if(n.pixels.resultPixels.fill)n.pixels.resultPixels.fill(e);else for(s=0;s<a;s++)n.pixels.resultPixels[s]=e},getDataTypeArray:function(n){var e;switch(n){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(n){var e;switch(n){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(n,e){if(e==null)return!1;var r;switch(n){case 0:r=e>=-128&&e<=127;break;case 1:r=e>=0&&e<=255;break;case 2:r=e>=-32768&&e<=32767;break;case 3:r=e>=0&&e<=65536;break;case 4:r=e>=-2147483648&&e<=2147483647;break;case 5:r=e>=0&&e<=4294967296;break;case 6:r=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:r=e>=5e-324&&e<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(n){var e=0;switch(n){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=n}return e},getDataTypeUsed:function(n,e){var r=n;switch(n){case 2:case 4:r=n-e;break;case 3:case 5:r=n-2*e;break;case 6:e===0?r=n:e===1?r=2:r=1;break;case 7:e===0?r=n:r=n-2*e+1;break;default:r=n;break}return r},getOnePixel:function(n,e,r,t){var a=0;switch(r){case 0:a=t.getInt8(e);break;case 1:a=t.getUint8(e);break;case 2:a=t.getInt16(e,!0);break;case 3:a=t.getUint16(e,!0);break;case 4:a=t.getInt32(e,!0);break;case 5:a=t.getUInt32(e,!0);break;case 6:a=t.getFloat32(e,!0);break;case 7:a=t.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return a}},C=function(n,e,r){this.val=n,this.left=e,this.right=r},_={decode:function(n,e){e=e||{};var r=e.noDataValue,t=0,a={};if(a.ptr=e.inputOffset||0,a.pixels={},!!D.readHeaderInfo(n,a)){var i=a.headerInfo,s=i.fileVersion,f=D.getDataTypeArray(i.imageType);D.readMask(n,a),i.numValidPixel!==i.width*i.height&&!a.pixels.resultMask&&(a.pixels.resultMask=e.maskData);var v=i.width*i.height;if(a.pixels.resultPixels=new f(v*i.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},i.numValidPixel!==0)if(i.zMax===i.zMin)D.constructConstantSurface(a);else if(s>=4&&D.checkMinMaxRanges(n,a))D.constructConstantSurface(a);else{var m=new DataView(n,a.ptr,2),o=m.getUint8(0);if(a.ptr++,o)D.readDataOneSweep(n,a,f);else if(s>1&&i.imageType<=1&&Math.abs(i.maxZError-.5)<1e-5){var l=m.getUint8(1);if(a.ptr++,a.encodeMode=l,l>2||s<4&&l>1)throw"Invalid Huffman flag "+l;l?D.readHuffman(n,a,f):D.readTiles(n,a,f)}else D.readTiles(n,a,f)}a.eofOffset=a.ptr;var h;e.inputOffset?(h=a.headerInfo.blobSize+e.inputOffset-a.ptr,Math.abs(h)>=1&&(a.eofOffset=e.inputOffset+a.headerInfo.blobSize)):(h=a.headerInfo.blobSize-a.ptr,Math.abs(h)>=1&&(a.eofOffset=a.headerInfo.blobSize));var u={width:i.width,height:i.height,pixelData:a.pixels.resultPixels,minValue:i.zMin,maxValue:i.zMax,validPixelCount:i.numValidPixel,dimCount:i.numDims,dimStats:{minValues:i.minValues,maxValues:i.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&D.isValidPixelValue(i.imageType,r)){var c=a.pixels.resultMask;for(t=0;t<v;t++)c[t]||(u.pixelData[t]=r);u.noDataValue=r}return a.noDataValue=r,e.returnFileInfo&&(u.fileInfo=D.formatFileInfo(a)),u}},getBandCount:function(n){var e=0,r=0,t={};for(t.ptr=0,t.pixels={};r<n.byteLength-58;)D.readHeaderInfo(n,t),r+=t.headerInfo.blobSize,e++,t.ptr=r;return e}};return _}(),X=function(){var A=new ArrayBuffer(4),D=new Uint8Array(A),C=new Uint32Array(A);return C[0]=1,D[0]===1}(),re={decode:function(A,D){if(!X)throw"Big endian system is not supported.";D=D||{};var C=D.inputOffset||0,_=new Uint8Array(A,C,10),n=String.fromCharCode.apply(null,_),e,r;if(n.trim()==="CntZImage")e=S,r=1;else if(n.substring(0,5)==="Lerc2")e=ne,r=2;else throw"Unexpected file identifier string: "+n;for(var t=0,a=A.byteLength-10,i,s=[],f,v,m={width:0,height:0,pixels:[],pixelType:D.pixelType,mask:null,statistics:[]};C<a;){var o=e.decode(A,{inputOffset:C,encodedMaskData:i,maskData:v,returnMask:t===0,returnEncodedMask:t===0,returnFileInfo:!0,pixelType:D.pixelType||null,noDataValue:D.noDataValue||null});C=o.fileInfo.eofOffset,t===0&&(i=o.encodedMaskData,v=o.maskData,m.width=o.width,m.height=o.height,m.dimCount=o.dimCount||1,m.pixelType=o.pixelType||o.fileInfo.pixelType,m.mask=o.maskData),r>1&&o.fileInfo.mask&&o.fileInfo.mask.numBytes>0&&s.push(o.maskData),t++,m.pixels.push(o.pixelData),m.statistics.push({minValue:o.minValue,maxValue:o.maxValue,noDataValue:o.noDataValue,dimStats:o.dimStats})}var l,h,u;if(r>1&&s.length>1){for(u=m.width*m.height,m.bandMasks=s,v=new Uint8Array(u),v.set(s[0]),l=1;l<s.length;l++)for(f=s[l],h=0;h<u;h++)v[h]=v[h]&f[h];m.maskData=v}return m}};typeof define=="function"&&define.amd?define([],function(){return re}):typeof xe<"u"&&xe.exports?xe.exports=re:this.Lerc=re})()});var xr={NONE:0,LERC:1},tr=Object.freeze(xr);var j={};j.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var He=new ee,Tr=new Ie,kr=new ee,yr=new ee;j.computeVertices=function(S){if(!W(S)||!W(S.heightmap))throw new ue("options.heightmap is required.");if(!W(S.width)||!W(S.height))throw new ue("options.width and options.height are required.");if(!W(S.nativeRectangle))throw new ue("options.nativeRectangle is required.");if(!W(S.skirtHeight))throw new ue("options.skirtHeight is required.");var ne=Math.cos,X=Math.sin,re=Math.sqrt,A=Math.atan,D=Math.exp,C=ve.PI_OVER_TWO,_=ve.toRadians,n=S.heightmap,e=S.width,r=S.height,t=S.skirtHeight,a=z(S.isGeographic,!0),i=z(S.ellipsoid,pe.WGS84),s=1/i.maximumRadius,f=S.nativeRectangle,v,m,o,l,h=S.rectangle;W(h)?(v=h.west,m=h.south,o=h.east,l=h.north):a?(v=_(f.west),m=_(f.south),o=_(f.east),l=_(f.north)):(v=f.west*s,m=C-2*A(D(-f.south*s)),o=f.east*s,l=C-2*A(D(-f.north*s)));var u=S.relativeToCenter,c=W(u);u=c?u:ee.ZERO;var g=z(S.exaggeration,1),x=z(S.includeWebMercatorT,!1),T=z(S.structure,j.DEFAULT_STRUCTURE),V=z(T.heightScale,j.DEFAULT_STRUCTURE.heightScale),I=z(T.heightOffset,j.DEFAULT_STRUCTURE.heightOffset),M=z(T.elementsPerHeight,j.DEFAULT_STRUCTURE.elementsPerHeight),d=z(T.stride,j.DEFAULT_STRUCTURE.stride),w=z(T.elementMultiplier,j.DEFAULT_STRUCTURE.elementMultiplier),U=z(T.isBigEndian,j.DEFAULT_STRUCTURE.isBigEndian),k=me.computeWidth(f),y=me.computeHeight(f),p=k/(e-1),B=y/(r-1);a||(k*=s,y*=s);var F=i.radiiSquared,L=F.x,N=F.y,b=F.z,E=65536,H=-65536,he=Pe.eastNorthUpToFixedFrame(u,i),Te=Ie.inverseTransformation(he,Tr),ie,ae;x&&(ie=Ue.geodeticLatitudeToMercatorAngle(m),ae=1/(Ue.geodeticLatitudeToMercatorAngle(l)-ie));var G=kr;G.x=Number.POSITIVE_INFINITY,G.y=Number.POSITIVE_INFINITY,G.z=Number.POSITIVE_INFINITY;var Y=yr;Y.x=Number.NEGATIVE_INFINITY,Y.y=Number.NEGATIVE_INFINITY,Y.z=Number.NEGATIVE_INFINITY;var q=Number.POSITIVE_INFINITY,O=e*r,or=t>0?e*2+r*2:0,te=O+or,ce=new Array(te),Oe=new Array(te),_e=new Array(te),Ye=x?new Array(te):[],ke=0,ye=r,Me=0,Ve=e;t>0&&(--ke,++ye,--Me,++Ve);for(var ge=1e-5,se=ke;se<ye;++se){var Q=se;Q<0&&(Q=0),Q>=r&&(Q=r-1);var Z=f.north-B*Q;a?Z=_(Z):Z=C-2*A(D(-Z*s));var De=(Z-m)/(l-m);De=ve.clamp(De,0,1);var we=se===ke,de=se===ye-1;t>0&&(we?Z+=ge*y:de&&(Z-=ge*y));var ze=ne(Z),Ae=X(Z),Xe=b*Ae,qe;x&&(qe=(Ue.geodeticLatitudeToMercatorAngle(Z)-ie)*ae);for(var le=Me;le<Ve;++le){var J=le;J<0&&(J=0),J>=e&&(J=e-1);var Se=Q*(e*d)+J*d,R;if(M===1)R=n[Se];else{R=0;var $;if(U)for($=0;$<M;++$)R=R*w+n[Se+$];else for($=M-1;$>=0;--$)R=R*w+n[Se+$]}R=(R*V+I)*g,H=Math.max(H,R),E=Math.min(E,R);var K=f.west+p*J;a?K=_(K):K=K*s;var Be=(K-v)/(o-v);Be=ve.clamp(Be,0,1);var P=Q*e+J;if(t>0){var Le=le===Me,Fe=le===Ve-1,ur=we||de||Le||Fe,vr=(we||de)&&(Le||Fe);if(vr)continue;ur&&(R-=t,Le?(P=O+(r-Q-1),K-=ge*k):de?P=O+r+(e-J-1):Fe?(P=O+r+e+Q,K+=ge*k):we&&(P=O+r+e+r+J))}var be=ze*ne(K),Ee=ze*X(K),Ze=L*be,We=N*Ee,mr=re(Ze*be+We*Ee+Xe*Ae),Ce=1/mr,hr=Ze*Ce,cr=We*Ce,gr=Xe*Ce,oe=new ee;oe.x=hr+be*R,oe.y=cr+Ee*R,oe.z=gr+Ae*R,ce[P]=oe,Oe[P]=R,_e[P]=new Ke(Be,De),x&&(Ye[P]=qe),Ie.multiplyByPoint(Te,oe,He),ee.minimumByComponent(He,G,G),ee.maximumByComponent(He,Y,Y),q=Math.min(q,R)}}var wr=$e.fromPoints(ce),je;W(h)&&(je=ir.fromRectangle(h,E,H,i));var Ge;if(c){var dr=new ar(i);Ge=dr.computeHorizonCullingPointPossiblyUnderEllipsoid(u,ce,E)}for(var pr=new rr(G,Y,u),Ne=new nr(pr,q,H,he,!1,x),Qe=new Float32Array(te*Ne.getStride()),Je=0,fe=0;fe<te;++fe)Je=Ne.encode(Qe,Je,ce[fe],_e[fe],Oe[fe],void 0,Ye[fe]);return{vertices:Qe,maximumHeight:H,minimumHeight:E,encoding:Ne,boundingSphere3D:wr,orientedBoundingBox:je,occludeePointInScaledSpace:Ge}};var fr=j;var lr=Ur(sr(),1);function Mr(S,ne){if(S.encoding===tr.LERC){var X;try{X=lr.default.decode(S.heightmap)}catch(C){throw new Re(C)}var re=X.statistics[0];if(re.minValue===Number.MAX_VALUE)throw new Re("Invalid tile data");S.heightmap=X.pixels[0],S.width=X.width,S.height=X.height}S.ellipsoid=pe.clone(S.ellipsoid),S.rectangle=me.clone(S.rectangle);var A=fr.computeVertices(S),D=A.vertices;return ne.push(D.buffer),{vertices:D.buffer,numberOfAttributes:A.encoding.getStride(),minimumHeight:A.minimumHeight,maximumHeight:A.maximumHeight,gridWidth:S.width,gridHeight:S.height,boundingSphere3D:A.boundingSphere3D,orientedBoundingBox:A.orientedBoundingBox,occludeePointInScaledSpace:A.occludeePointInScaledSpace,encoding:A.encoding,westIndicesSouthToNorth:A.westIndicesSouthToNorth,southIndicesEastToWest:A.southIndicesEastToWest,eastIndicesNorthToSouth:A.eastIndicesNorthToSouth,northIndicesWestToEast:A.northIndicesWestToEast}}var Kr=er(Mr);export{Kr as default};
