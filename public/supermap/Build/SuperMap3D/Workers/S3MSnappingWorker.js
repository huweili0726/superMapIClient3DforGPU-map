import{a as $}from"./chunk-6NCRHY5H.js";import"./chunk-TAUHZ2AB.js";import{a as X}from"./chunk-AMRCVYIA.js";import"./chunk-DAQQE4FA.js";import{c as m}from"./chunk-YOUPUNCB.js";import"./chunk-ZIZDQ7PT.js";import"./chunk-QO3RRUEO.js";import{a as j}from"./chunk-RRHLFRBE.js";import"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-JTWCWMT6.js";import"./chunk-EHDXVZQM.js";import"./chunk-3CEYC7M5.js";import"./chunk-SVO3L3ZS.js";import"./chunk-ZCGLU37G.js";import"./chunk-E37TXANJ.js";import{a as u}from"./chunk-DJQWO2NJ.js";import{a as Z}from"./chunk-Y2ETSBLW.js";import{a as R}from"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as N}from"./chunk-PJGSCWXZ.js";import{a as S}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";function x(e,t,i,n=1,o=0){if(this._ctor=e,this._acquireFunction=t,this._releaseFunction=i,this.allocationSize=n,this._pool=Array(o),this._initialSize=o,this._ctor)for(e=0;e<o;e++)this._pool[e]=new this._ctor;this.allocationSize=Math.max(n,1)}x.prototype.destroy=function(){this.prune(0)};x.prototype.acquire=function(...e){if(x.test.disabled)var t=new this._ctor;else{if(this._pool.length===0){t=this.allocationSize;for(let i=0;i<t;i++)this._pool[i]=new this._ctor}t=this._pool.pop()}return this._acquireFunction?this._acquireFunction(t,...e):t&&t.acquire&&typeof t.acquire=="function"&&t.acquire(...e),t};x.prototype.release=function(e){e&&!x.test.disabled&&(this._releaseFunction?this._releaseFunction(e):e&&e.release&&typeof e.release=="function"&&e.release(),this._pool.push(e))};x.prototype.prune=function(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t)this._dispose(this._pool[t]);this._pool.length=e}};x.prototype._dispose=function(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()};x.test={disabled:!1};var A=x;var q=(e,t,i,n)=>{let o=t,s=i>>>1,r=e[o-1];for(;t<=s;){t=o<<1,t<i&&0>n(e[t-1],e[t])&&++t;let h=e[t-1];if(0>=n(h,r))break;e[o-1]=h,o=t}e[o-1]=r},V=(e,t)=>e<t?-1:e>t?1:0;function L(){}L.sort=function(e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=e.length),n===void 0&&(n=V);for(var o=i>>>1;o>t;o--)q(e,o,i,n);for(o=t+1,--i;i>t;i--){let s=e[t];e[t]=e[i],e[i]=s,q(e,o,i,n)}};L.iterableSort=function*(e,t,i,n){t===void 0&&(t=0),i===void 0&&(i=e.length),n===void 0&&(n=V);for(var o=i>>>1;o>t;o--)q(e,o,i,n),yield;for(o=t+1,--i;i>t;i--){let s=e[t];e[t]=e[i],e[i]=s,q(e,o,i,n),yield}};var U=L;function w(e=1){this._seed=e}Object.defineProperties(w.prototype,{seed:{set:function(e){this._seed=e??Math.random()*c._m}}});w.prototype.getInt=function(){return this._seed=(c._a*this._seed+c._c)%c._m};w.prototype.getFloat=function(){return this.getInt()/(c._m-1)};w.prototype.getIntRange=function(e,t){return Math.round(this.getFloatRange(e,t))};w.prototype.getFloatRange=function(e,t){t-=e;let i=this.getInt()/c._m;return e+i*t};w._m=2147483647;w._a=48271;w._c=0;var D=w;function f(){}function et(e){return e}function it(e){return e?(tt.seed=e,()=>tt.getFloat()):Math.random}var ut=1/1.5,ft=!!Array.prototype.fill;function H(){this.last=0}var nt=new H,v=new Set,tt=new D;f.EmptyArray=[];f.ReallocGrowthFactor=1.5;f.ReallocShrinkFactor=ut;f.ReallocShrinkTreshold=.5;f.binaryFindClosest=function(e,t,i){if(e&&e.length!==0){var n=e.length-1,o=e[0];if(t<=i(o)||(o=e[n],t>=i(o)))return o;var s=0;o=0;for(var r=n;s<r;){o=s+Math.floor((r-s)/2);let l=e[o],a=i(l);if(a===t)return l;if(t<a){if(0<o){r=e[o-1];var h=i(r);if(t>h)return t-h>=a-t?l:r}r=o}else{if(o<n&&(s=e[o+1],h=i(s),t<h))return t-a>=h-t?s:l;s=o+1}}return e[o]}};f.binaryIndexOf=function(e,t,i){let n=e.length,o=0;for(var s=n-1;o<s;){let r=o+Math.floor((s-o)/2);t>e[r]?o=r+1:s=r}return s=e[o],i?t>=e[n-1]?-1:s===t?o:o-1:s===t?o:-1};f.constant=function(e,t){if(ft)return Array(e).fill(t);let i=Array(e);for(let n=0;n<e;n++)i[n]=t;return i};f.difference=function(e,t,i){let n,o;return i?(n=t.filter(s=>!e.some(r=>i(r,s))),o=e.filter(s=>!t.some(r=>i(r,s)))):(n=t.filter(s=>!e.includes(s)),o=e.filter(s=>!t.includes(s))),{added:n,removed:o}};f.equals=function(e,t,i){if(e==null&&t==null)return!0;if(e==null||t==null||e.length!==t.length)return!1;if(i){for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1}else for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};f.filterInPlace=function(e,t){let i=0;for(let n=0;n<e.length;++n){let o=e[n];t(o,n)&&(e[i]=o,i++)}e.length=i};f.first=function(e){if(e)return 0<e.length?e[0]:void 0};f.groupToMap=function(e,t){let i=new Map,n=e.length;for(let o=0;o<n;o++){let s=e[o],r=t(s,o,e),h=i.get(r);h?h.push(s):i.set(r,[s])}return i};f.intersect=function(e,t,i){return e&&t?i?e.filter(n=>-1<t.findIndex(o=>i(n,o))):e.filter(n=>t.includes(n)):[]};f.isArrayLike=function(e){return e&&typeof e.length=="number"};f.isSome=function(e,t){return e!=null};f.last=function(e){if(e){var t=e.length;return 0<t?e[t-1]:void 0}};f.max=function(e,t=et){if(e&&e.length!==0){var i=e[0],n=t(i);for(let o=1;o<e.length;++o){let s=e[o],r=Number(t(s));r>n&&(n=r,i=s)}return i}};f.min=function(e,t=et){return f.max(e,i=>-t(i))};f.pickRandom=function(e,t,i){let n=e.length;if(t>=n)return e.slice(0);let o=it(i),s=new Set,r=[];for(;r.length<t;){let h=Math.floor(o()*n);s.has(h)||(s.add(h),r.push(e[h]))}return r};f.range=function(e,t){t===void 0&&(t=e,e=0);let i=Array(t-e);for(let n=e;n<t;n++)i[n-e]=n;return i};f.indexOf=function(e,t,i,n){n=n||nt;var o=Math.max(0,n.last-10);for(let s=o;s<i;++s)if(e[s]===t)return n.last=s;for(i=Math.min(o,i),o=0;o<i;++o)if(e[o]===t)return n.last=o;return-1};f.remove=function(e,t){let i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null};f.removeUnordered=function(e,t,i,n){let o=i??e.length,s=f.indexOf(e,t,o,n);if(s!==-1)return e[s]=e[o-1],i==null&&e.pop(),t};f.removeUnorderedMany=function(e,t,i=e.length,n=t.length,o,s){if(n===0||i===0)return i;v.clear();for(let l=0;l<n;++l)v.add(t[l]);o=o||nt;let r=Math.max(0,o.last-10);for(var h=r;h<i;++h)if(v.has(e[h])&&(s&&s.push(e[h]),v.delete(e[h]),e[h]=e[i-1],--i,--h,v.size===0||i===0))return v.clear(),i;for(var h=0;h<r;++h)if(v.has(e[h])&&(s&&s.push(e[h]),v.delete(e[h]),e[h]=e[i-1],--i,--h,v.size===0||i===0))return v.clear(),i;return v.clear(),i};f.shuffle=function(e,t){let i=it(t);for(let n=e.length-1;0<n;n--){let o=Math.floor(i()*(n+1)),s=e[n];e[n]=e[o],e[o]=s}return e};f.splitIntoChunks=function(e,t){let i=e.length;if(i===0)return[];let n=[];for(let o=0;o<i;o+=t)n.push(e.slice(o,o+t));return n};f.unique=function(e,t){return t?e.filter((i,n,o)=>o.findIndex(t.bind(null,i))===n):e.filter((i,n,o)=>o.indexOf(i)===n)};f.update=function(e,t){let i=e.length!==t.length;i&&(e.length=t.length);for(let n=0;n<t.length;++n)e[n]!==t[n]&&(e[n]=t[n],i=!0);return i};var B=f;function ot(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}function d(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new H,e&&(e.initialSize&&(this.data=Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>ot(this)))}d.prototype.toArray=function(){return this.data.slice(0,this.length)};d.prototype.filter=function(e){let t=[];for(let i=0;i<this._length;i++){let n=this.data[i];e(n)&&t.push(n)}return t};d.prototype.at=function(e){if(e=Math.trunc(e)||0,0>e&&(e+=this._length),!(0>e||e>=this._length))return this.data[e]};d.prototype.includes=function(e,t){return e=this.data.indexOf(e,t),e!==-1&&e<this.length};d.prototype.clear=function(){this.length=0};d.prototype.prune=function(){this.clear(),this.data=[]};d.prototype.push=function(e){this.data[this._length++]=e};d.prototype.pushArray=function(e,t=e.length){for(let i=0;i<t;i++)this.data[this._length++]=e[i]};d.prototype.fill=function(e,t){for(let i=0;i<t;i++)this.data[this._length++]=e};d.prototype.pushNew=function(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));let e=this.data[this._length];return++this._length,e};d.prototype.unshift=function(e){this.data.unshift(e),this._length++,ot(this)};d.prototype.pop=function(){if(this.length!==0){var e=this.data[this.length-1];return--this.length,this._shrink(),e}};d.prototype.remove=function(e){let t=B.indexOf(this.data,e,this.length,this._hint);if(t!==-1)return this.data.splice(t,1),--this.length,e};d.prototype.removeUnordered=function(e){return this.removeUnorderedIndex(B.indexOf(this.data,e,this.length,this._hint))};d.prototype.removeUnorderedIndex=function(e){if(!(e>=this.length||0>e))return this.swapElements(e,this.length-1),this.pop()};d.prototype.removeUnorderedMany=function(e,t=e.length,i){this.length=B.removeUnorderedMany(this.data,e,this.length,t,this._hint,i),this._shrink()};d.prototype.front=function(){if(this.length!==0)return this.data[0]};d.prototype.back=function(){if(this.length!==0)return this.data[this.length-1]};d.prototype.swapElements=function(e,t){if(!(e>=this.length||t>=this.length||e===t)){var i=this.data[e];this.data[e]=this.data[t],this.data[t]=i}};d.prototype.sort=function(e){U.sort(this.data,0,this.length,e)};d.prototype.iterableSort=function(e){return U.iterableSort(this.data,0,this.length,e)};d.prototype.some=function(e,t){for(let i=0;i<this.length;++i)if(e.call(t,this.data[i],i,this.data))return!0;return!1};d.prototype.find=function(e,t){for(let i=0;i<this.length;++i){let n=this.data[i];if(e.call(t,n,i))return n}};d.prototype.filterInPlace=function(e,t){let i=0;for(let n=0;n<this._length;++n){let o=this.data[n];e.call(t,o,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=o,i++)}if(this._deallocator)for(e=i;e<this._length;e++)this.data[e]=this._deallocator(this.data[e]);return this._length=i,this._shrink(),this};d.prototype.forAll=function(e,t){let i=this.length,n=this.data;for(let o=0;o<i;++o)e.call(t,n[o],o,n)};d.prototype.forEach=function(e,t){for(let i=0;i<this.length;++i)e.call(t,this.data[i],i,this.data)};d.prototype.map=function(e,t){let i=Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(t,this.data[n],n,this.data);return i};d.prototype.reduce=function(e,t){for(let i=0;i<this.length;++i)t=e(t,this.data[i],i,this.data);return t};d.prototype.has=function(e){let t=this.length,i=this.data;for(let n=0;n<t;++n)if(i[n]===e)return!0;return!1};Object.defineProperties(d.prototype,{length:{get:function(){return this._length},set:function(e){if(e>this._length)if(this._allocator)for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);else this._length=e;else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}}});var T=d;var P=class{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(t,i){i=R(i,R.EMPTY_OBJECT),this.objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,S(i.maximumObjectsPerNode)&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),S(i.maximumDepth)&&(this._maximumDepth=i.maximumDepth)}destroy(){this._degenerateObjects.clear(),p.clearPool(),I[0]=null,O.prune(),_t.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);let n=p.acquire();for(let o=0;o<i;o++){let s=t[o];this._isDegenerate(s)?this._degenerateObjects.add(s):(n.init(this._root),this._add(s,n))}p.release(n)}remove(t,i=null){this._objectCount-=t.length;let n=p.acquire();for(let o of t){let s=i??m.clone(this.objectToBoundingSphere(o),pt);k(s.radius)?(n.init(this._root),this._remove(o,s,n)):this._degenerateObjects.delete(o)}p.release(n),this._shrink()}update(t,i){if(!k(i.radius)&&this._isDegenerate(t))return;let n=function(o){return I[0]=o,I}(t);this.remove(n,i),this.add(n)}forEachAlongRay(t,i,n){}forEachAlongRayWithVerticalOffset(t,i,n,o){}forEach(t){this._forEachNode(this._root,i=>{let n=i.node;return n.terminals.forAll(t),n.residents!==null&&n.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,n,o=()=>!0,s=1/0){}forEachInDepthRange(t,i,n,o,s,r,h){}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(t,i){let n=i.radius,o=i.center,s=l=>{let a=this.objectToBoundingSphere(l),_=a.radius,b=n+_;return u.distanceSquared(a.center,o)-b*b<=0?t(l):!0},r=!0,h=l=>{r&&(r=s(l))};this._forEachNode(this._root,l=>{let a=l.bounds.radius,_=n+a;if(u.distanceSquared(l.bounds.center,o)-_*_>0)return!1;let b=l.node;return b.terminals.forAll(h),r&&b.residents!=null&&b.residents.forAll(h),r}),r&&this.forEachDegenerateObject(h)}_intersectsNode(t,i){}_intersectsNodeWithOffset(t,i,n){}_intersectsObject(t,i){}_intersectsObjectWithOffset(t,i,n){}_forEachNode(t,i){let n=p.acquire().init(t),o=[n];for(;o.length!=0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let s=0;s<n.node.children.length;s++)n.node.children[s]&&o.push(p.acquire().init(n).advance(s));p.release(n)}}_forEachNodeDepthOrdered(t,i,n,o=P.DepthOrder.FRONT_TO_BACK){}_remove(t,i,n){O.clear();let o=n.advanceTo(i,(s,r)=>{O.push(s.node),O.push(r)})?n.node.terminals:n.node.residents;if(o.removeUnordered(t),o.length===0)for(let s=O.length-2;s>=0;s-=2){let r=O.data[s],h=O.data[s+1];if(!this._purge(r,h))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new T({shrink:!0})),!0)}_add(t,i){i.advanceTo(this.objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){let i=t.node.residents;t.node.residents=null;for(let n=0;n<i.length;n++){let o=p.acquire().init(t);this._add(i.at(n),o),p.release(o)}}_grow(t,i){if(i!==0&&(st(t,i,n=>this.objectToBoundingSphere(n),z),k(z.radius)&&!this._fitsInsideTree(z)))if(this._nodeIsEmpty(this._root.node))m.clone(z,this._root.bounds),this._root.halfSize=1.25*this._root.bounds.radius,this._root.updateBoundsRadiusFromHalfSize();else{let n=this._rootBoundsForRootAsSubNode(z);this._placingRootViolatesMaxDepth(n)?this._rebuildTree(z,n):this._growRootAsSubNode(n),p.release(n)}}_rebuildTree(t,i){m.clone(i.bounds,G),G.radius=i.halfSize,st([t,G],2,o=>o,K);let n=p.acquire().init(this._root);this._root.initFrom(null,K,K.radius),this._root.increaseHalfSize(1.25),this._forEachNode(n,o=>(this.add(o.node.terminals.data,o.node.terminals.length),o.node.residents!==null&&this.add(o.node.residents.data,o.node.residents.length),!0)),p.release(n)}_placingRootViolatesMaxDepth(t){let i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E,n=0;return this._forEachNode(this._root,o=>(n=Math.max(n,o.depth),n+i<=this._maximumDepth)),n+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){var i=t.radius,n=-1/0;let o=m.pack(this._root.bounds,[],0),s=this._root.halfSize;t=m.pack(t,[],0);for(var r=0;3>r;r++){var h=Math.max(0,Math.ceil((o[r]-s-(t[r]-i))/(2*s)));let a=Math.max(0,Math.ceil((t[r]+i-(o[r]+s))/(2*s)))+1;n=Math.max(n,2**Math.ceil(Math.log(h+a)*Math.LOG2E)),F[r].min=h,F[r].max=a}let l=[];for(t=0;3>t;t++)i=F[t].min,r=F[t].max,h=(n-(i+r))/2,i+=Math.ceil(h),r+=Math.floor(h),l[t]=o[t]-s-i*s*2+(r+i)*s;return n*=s,l[3]=n*ht,m.unpack(l,0,rt),p.acquire().initFrom(null,rt,n,0)}_growRootAsSubNode(t){let i=this._root.node;m.clone(this._root.bounds,z),z.radius=this._root.halfSize,this._root.init(t),t.advanceTo(z,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){let t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null,i=this._root.node.children,n=0,o=0;for(;o<i.length&&t==null;)n=o++,t=i[n];for(;o<i.length;)if(i[o++])return-1;return n}_isDegenerate(t){return!k(this.objectToBoundingSphere(t).radius)}_fitsInsideTree(t){let i=this._root.bounds,n=this._root.halfSize;return t.radius<=n&&t.center.x>=i.center.x-n&&t.center.x<=i.center.x+n&&t.center.y>=i.center.y-n&&t.center.y<=i.center.y+n&&t.center.z>=i.center.z-n&&t.center.z<=i.center.z+n}toJSON(){}_nodeToJSON(t){}static fromJSON(t){}},p=class{constructor(){this.bounds=new m,this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,n,o=this.depth){return this.node=t??p.createEmptyNode(),i!=null&&m.clone(i,this.bounds),this.halfSize=n,this.depth=o,this}increaseHalfSize(t){this.halfSize*=t,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds.radius=this.halfSize*ht}advance(t){let i=this.node.children[t];i||(i=p.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;let n=at[t];return this.bounds.center.x+=n[0]*this.halfSize,this.bounds.center.y+=n[1]*this.halfSize,this.bounds.center.z+=n[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(t,i,n=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!n)return i&&i(this,-1),!1;this.node.residents=null}let o=this._childIndex(t);i&&i(this,o),this.advance(o)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t.radius>this.halfSize/2}_childIndex(t){let i=this.bounds;return(i.center.x<t.center.x?1:0)+(i.center.y<t.center.y?2:0)+(i.center.z<t.center.z?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new T({shrink:!0}),residents:new T({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(t){p._pool.release(t)}static clearPool(){p._pool.prune()}};function dt(e,t){e.x=Math.max(e.x,t.center.x+t.radius),e.y=Math.max(e.y,t.center.y+t.radius),e.z=Math.max(e.z,t.center.z+t.radius)}function st(e,t,i,n){if(t===1){let r=i(e[0]);m.clone(r,n)}else{var o,s;E.x=1/0,E.y=1/0,E.z=1/0,M.x=-1/0,M.y=-1/0,M.z=-1/0;for(let r=0;r<t;r++){let h=i(e[r]);k(h.radius)&&(s=h,o=E,o.x=Math.min(o.x,s.center.x-s.radius),o.y=Math.min(o.y,s.center.y-s.radius),o.z=Math.min(o.z,s.center.z-s.radius),dt(M,h))}u.lerp(E,M,.5,n.center),n.radius=Math.max(M.x-E.x,M.y-E.y,M.z-E.z)/2}}function k(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new A(p);(function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(P||(P={}));var at=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]];var ht=Math.sqrt(3),I=[null],rt=new m,kt=new u,E=new u,M=new u,O=new T,pt=new m,z=new m,G=new m,K=new m,F=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],_t=new T;var W=P;function y(){this._array=[],this._hash={}}Object.defineProperties(y.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}});y.prototype.contains=function(e){if(typeof e!="string"&&typeof e!="number")throw new N("key is required to be a string or number.");return S(this._hash[e])};y.prototype.set=function(e,t){if(typeof e!="string"&&typeof e!="number")throw new N("key is required to be a string or number.");var i=this._hash[e];t!==i&&(this.remove(e),this._hash[e]=t,this._array.push(t))};y.prototype.get=function(e){if(typeof e!="string"&&typeof e!="number")throw new N("key is required to be a string or number.");return this._hash[e]};y.prototype.remove=function(e){if(S(e)&&typeof e!="string"&&typeof e!="number")throw new N("key is required to be a string or number.");var t=this._hash[e],i=S(t);if(i){var n=this._array;n.splice(n.indexOf(t),1),delete this._hash[e]}return i};y.prototype.removeAll=function(){var e=this._array;e.length>0&&(this._hash={},e.length=0)};y.clone=function(e,t){if(!!S(e)){S(t)?t.removeAll():t=new y;for(var i in e._hash)e._hash.hasOwnProperty(i)&&t.set(i,e._hash[i]);return t}};var lt=y;var J=class{constructor(){this._idToComponent=new Map,this._components=new W(t=>t.bounds),this._edges=new W(t=>t.bounds),this._tmpP1=new u,this._tmpP2=new u,this._tmpP3=new u}fetchCandidates(t,i){let n=this._ensureEdgeLocations(t,i);if(n.length>0)return{fetchEdgeLocations:!0,data:{components:n}};let o=[];return this._edges.forEachNeighbor(s=>(this._addCandidates(t,s,o),o.length<1e3),t.bounds),{candidates:o}}_ensureEdgeLocations(t,i){let n=[];return this._components.forEachNeighbor(o=>{if(o.info==null){let{id:s,uid:r}=o;n.push({id:s,uid:r})}return!0},t.bounds),n}add(t){let i=new C(t.id,t.bounds);return this._idToComponent.set(i.id,i),this._components.add([i]),!0}remove(t){let i=this._idToComponent.get(t.id);if(i){let n=[];this._edges.forEachNeighbor(o=>(o.component===i&&n.push(o),!0),i.bounds),this._edges.remove(n),this._components.remove([i]),this._idToComponent.delete(i.id)}return!0}debuggerComponentByID(t){let i=this._idToComponent.get(t.id),n=[];return i&&(t.type===0?this._edges.forEach(o=>{o.component===i&&this._debuggerEdge(o,n)}):this._edges.forEachNode((o,s,r,h)=>{if(h===3){var l=m.clone(s),a=[],_=[];o.residents&&o.residents.data.forEach(b=>{this._debuggerEdge(b,a)}),o.terminals&&o.terminals.data.forEach(b=>{this._debuggerEdge(b,_)}),n.push({residents:a,terminals:_,bounds:l})}return!0})),{component:n}}setFetchEdgeLocations(t){for(let n of t){let o=this._idToComponent.get(n.id);if(o!=null&&n.uid===o.uid){let s=$.createEdgeData(n.locations.vertexPackage,n.locations.indexPackage,!0),r={buffer:s.regular.instancesData,count:s.regular.instanceCount},h=Array(r.count),l=new u,a=new u;for(let _=0;_<r.count;_++){l.x=r.buffer[_*g],l.y=r.buffer[_*g+1],l.z=r.buffer[_*g+2],a.x=r.buffer[_*g+3],a.y=r.buffer[_*g+4],a.z=r.buffer[_*g+5];var i=mt(l,a,n.modelMatrix);i=new Q(o,_,i),h[_]=i}this._edges.add(h),o.info={locations:r,objectIds:n.objectIds,modelMatrix:n.modelMatrix}}}}_addCandidates(t,i,n){var o=i.component.info;let{objectIds:s,modelMatrix:r}=o,l=o.locations.buffer;this._tmpP1.x=l[i.index*g],this._tmpP1.y=l[i.index*g+1],this._tmpP1.z=l[i.index*g+2],this._tmpP2.x=l[i.index*g+3],this._tmpP2.y=l[i.index*g+4],this._tmpP2.z=l[i.index*g+5];let a=j.multiplyByPoint(r,this._tmpP1,this._tmpP1),_=j.multiplyByPoint(r,this._tmpP2,this._tmpP2),b=s[l[i.index*g+9]];this._addEdgeCandidate(t,b,a,_,n),this._addVertexCandidate(t,b,a,n),this._addVertexCandidate(t,b,_,n)}_debuggerEdge(t,i){var{info:n}=t.component;let{objectIds:o,modelMatrix:s}=n,h=n.locations.buffer;this._tmpP1.x=h[t.index*g],this._tmpP1.y=h[t.index*g+1],this._tmpP1.z=h[t.index*g+2],this._tmpP2.x=h[t.index*g+3],this._tmpP2.y=h[t.index*g+4],this._tmpP2.z=h[t.index*g+5];let l=o[h[t.index*g+9]],a=j.multiplyByPoint(s,this._tmpP1,this._tmpP1),_=j.multiplyByPoint(s,this._tmpP2,this._tmpP2);i.push({type:"edge",start:u.clone(a),end:u.clone(_),objectId:l})}_addEdgeCandidate(t,i,n,o,s){if(t.returnEdge){var r=t.bounds.center,h=u.subtract(o,n,new u),l=gt(r,n,h,this._tmpP3);m.distanceSquaredTo(t.bounds,l)<=0&&s.push({type:"edge",objectId:i,target:u.clone(l),distance:u.distance(r,l),start:u.clone(n),end:u.clone(o)})}}_addVertexCandidate(t,i,n,o){if(t.returnVertex){var s=t.bounds.center;m.distanceSquaredTo(t.bounds,n)<=0&&o.push({type:"vertex",objectId:i,target:u.clone(n),distance:u.distance(s,n)})}}};function mt(e,t,i){var n=new m,o=n.center;return u.multiplyByScalar(e,.5,e),u.add(o,e,o),u.multiplyByScalar(t,.5,t),u.add(o,t,o),n.radius=u.distance(o,e),j.multiplyByPoint(i,o,o),n}function gt(e,t,i,n){u.subtract(e,t,n);var o=u.dot(n,i)/u.dot(i,i);return u.multiplyByScalar(i,Z.clamp(o,0,1),n),u.add(n,t,n)}var C=class{constructor(t,i){this.id=t,this.bounds=i,this.info=null,this.uid=++C.uid}};C.uid=0;var Q=class{constructor(t,i,n){this.component=t,this.index=i,this.bounds=n}},g=10,Y=class{constructor(){this._wokers=new lt}invoke(t){var i=R(t.createNew,!1);if(i)return this._wokers.contains(t.layerID)||this._wokers.set(t.layerID,new J),!0;var n=this._wokers.get(t.layerID);return n[t.methodName](t.data)}},ct;function bt(e,t){return e.initialize&&(ct=new Y),!0}function vt(e,t){return e.initialize?bt(e,t):ct.invoke(e)}var Zt=X(vt);export{Zt as default};
