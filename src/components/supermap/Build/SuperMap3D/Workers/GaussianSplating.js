import{a as y}from"./chunk-AMRCVYIA.js";import"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var M=new Float32Array(1),D=new Int32Array(M.buffer);function g(f){M[0]=f;var u=D[0],b=u>>31&1,s=u>>23&255,l=u&8388607,a;return s==0?a=0:s<113?(a=0,l|=8388608,l=l>>113-s,l&16777216&&(a=1,l=0)):s<142?a=s-112:(a=31,l=0),b<<15|a<<10|l>>13}function S(f,u){let{positions:b,scales:s,rotations:l,colors:a}=u;var o=new Uint32Array(f*8),i=new Uint8Array(o.buffer),n=new Float32Array(o.buffer);for(let r=0;r<f;r++){n[8*r+0]=b[r*3+0],n[8*r+1]=b[r*3+1],n[8*r+2]=b[r*3+2],i[4*(8*r+7)+0]=a[r*4+0],i[4*(8*r+7)+1]=a[r*4+1],i[4*(8*r+7)+2]=a[r*4+2],i[4*(8*r+7)+3]=a[r*4+3];let p=[s[r*3+0],s[r*3+1],s[r*3+2]],e=[l[r*4+0],l[r*4+1],l[r*4+2],l[r*4+3]],t=[1-2*(e[2]*e[2]+e[3]*e[3]),2*(e[1]*e[2]+e[0]*e[3]),2*(e[1]*e[3]-e[0]*e[2]),2*(e[1]*e[2]-e[0]*e[3]),1-2*(e[1]*e[1]+e[3]*e[3]),2*(e[2]*e[3]+e[0]*e[1]),2*(e[1]*e[3]+e[0]*e[2]),2*(e[2]*e[3]-e[0]*e[1]),1-2*(e[1]*e[1]+e[2]*e[2])].map((x,w)=>x*p[Math.floor(w/3)]),c=[t[0]*t[0]+t[3]*t[3]+t[6]*t[6],t[0]*t[1]+t[3]*t[4]+t[6]*t[7],t[0]*t[2]+t[3]*t[5]+t[6]*t[8],t[1]*t[1]+t[4]*t[4]+t[7]*t[7],t[1]*t[2]+t[4]*t[5]+t[7]*t[8],t[2]*t[2]+t[5]*t[5]+t[8]*t[8]];o[8*r+4]=A(4*c[0],4*c[1]),o[8*r+5]=A(4*c[2],4*c[3]),o[8*r+6]=A(4*c[4],4*c[5])}return o}function A(f,u){return(g(f)|g(u)<<16)>>>0}function T(f,u,b,s,l,a=4){let o=new Float32Array(l*3);if(u){let i=new Int16Array(f.buffer,f.byteOffset,f.byteLength/2);for(let n=0,r=i.length/a;n<r;n++)o[n*3]=i[n*a]*s+b.x,o[n*3+1]=i[n*a+1]*s+b.y,o[n*3+2]=i[n*a+2]*s+b.z}else{let i=new Float32Array(f.buffer,f.byteOffset,f.byteLength/4);if(a===3)return i;for(let n=0,r=i.length/4;n<r;n++)o[n*3]=i[n*4],o[n*3+1]=i[n*4+1],o[n*3+2]=i[n*4+2]}return o}function F(f,u,b=!1){if(!u)return new Float32Array(f.buffer,f.byteOffset,f.byteLength/4);if(b){let l=new Float32Array(f.length/4*3);for(let a=0,o=f.length/4;a<o;a++)l[a*3]=Math.exp(f[a*4]/16-10),l[a*3+1]=Math.exp(f[a*4+1]/16-10),l[a*3+2]=Math.exp(f[a*4+2]/16-10);return l}let s=new Float32Array(f.length);for(let l=0,a=f.length;l<a;l+=4){let o=f[l]/127.5-1,i=f[l+1]/127.5-1,n=f[l+2]/127.5-1,r=Math.sqrt(Math.max(0,1-(o*o+i*i+n*n)));s[l]=r,s[l+1]=o,s[l+2]=i,s[l+3]=n}return s}function k(f,u){let b=f.isSPZCompress,{posArray:s,colArray:l,scaArray:a,rotArray:o,isCompress:i,splatCount:n,positionDimension:r,minVerticesValue:p,vertCompressConstant:e}=f,t=T(s,i,p,e,n,r),c=new Uint8Array(l.buffer,l.byteOffset,l.byteLength),x=F(a,b,!0),w=F(o,b,!1),h=S(n,{positions:t,scales:x,rotations:w,colors:c});return u&&u.push(t.buffer,h.buffer),{bufferPos:t,texData:h}}function m(f,u){if(f.type==="textureData")return k(f,u)}var _=y(m);export{_ as default};
