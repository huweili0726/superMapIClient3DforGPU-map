import{a as Ee}from"./chunk-4BBYSOVM.js";import{a as d}from"./chunk-DZLEJEOM.js";import{a as B}from"./chunk-7P6MBKDE.js";import"./chunk-3YVIVL5K.js";import{a as T}from"./chunk-RYEDLSXB.js";import{a as g}from"./chunk-SP6GVFX5.js";import{a as Ae}from"./chunk-4WVDVRKW.js";import"./chunk-4XC5RTMX.js";import"./chunk-KBENTI6G.js";import"./chunk-L77WLOIG.js";import{a as Pe}from"./chunk-DAQQE4FA.js";import{a as we}from"./chunk-UIA2BV6O.js";import{a as me,g as _e,h as S}from"./chunk-T3RVX7V2.js";import"./chunk-NPAFDOYL.js";import{c as se}from"./chunk-YOUPUNCB.js";import"./chunk-ZIZDQ7PT.js";import{a as ue}from"./chunk-QO3RRUEO.js";import"./chunk-RRHLFRBE.js";import{a as M}from"./chunk-SRPTWKHW.js";import"./chunk-6S43R6PL.js";import"./chunk-GMH62RQ6.js";import"./chunk-6NA2GRXE.js";import"./chunk-JTWCWMT6.js";import"./chunk-NBA64YIR.js";import"./chunk-EHDXVZQM.js";import"./chunk-3CEYC7M5.js";import{b as w}from"./chunk-SVO3L3ZS.js";import"./chunk-ZCGLU37G.js";import"./chunk-E37TXANJ.js";import{a as v}from"./chunk-DJQWO2NJ.js";import{a as $}from"./chunk-Y2ETSBLW.js";import{a as _}from"./chunk-UBHQMGET.js";import"./chunk-EDZQSM3T.js";import{a as L}from"./chunk-PJGSCWXZ.js";import{a as l}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";function Ce(e,r){if(!l(e)||!l(r))throw new L("identifier and message are required.");Ee(e,r)}var Te=Ce;var ge=[];function Re(e,r,t,o,i){var f=ge;f.length=i;var n,O=t.red,D=t.green,E=t.blue,b=t.alpha,h=o.red,a=o.green,A=o.blue,p=o.alpha;if(d.equals(t,o)){for(n=0;n<i;n++)f[n]=d.clone(t);return f}var c=(h-O)/i,F=(a-D)/i,N=(A-E)/i,U=(p-b)/i;for(n=0;n<i;n++)f[n]=new d(O+n*c,D+n*F,E+n*N,b+n*U);return f}function R(e){e=_(e,_.EMPTY_OBJECT);var r=e.positions,t=e.colors,o=_(e.width,1),i=_(e.hMax,-1),f=_(e.colorsPerVertex,!1);if(!l(r)||r.length<2)throw new L("At least two positions are required.");if(typeof o!="number")throw new L("width must be a number");if(l(t)&&(f&&t.length<r.length||!f&&t.length<r.length-1))throw new L("colors has an invalid length.");this._positions=r,this._colors=t,this._width=o,this._hMax=i,this._colorsPerVertex=f,this._dist=e.dist,this._period=e.period,this._vertexFormat=T.clone(_(e.vertexFormat,T.DEFAULT)),this._followSurface=_(e.followSurface,!0),l(e.followSurface)&&(Te("PolylineGeometry.followSurface","PolylineGeometry.followSurface is deprecated and will be removed in SuperMap3D. Use PolylineGeometry.arcType instead."),e.arcType=e.followSurface?g.GEODESIC:g.NONE),this._arcType=_(e.arcType,g.GEODESIC),this._followSurface=this._arcType!==g.NONE,this._granularity=_(e.granularity,$.RADIANS_PER_DEGREE),this._ellipsoid=w.clone(_(e.ellipsoid,w.WGS84)),this._workerName="createPolylineGeometry";var n=1+r.length*v.packedLength;n+=l(t)?1+t.length*d.packedLength:1,this.packedLength=n+w.packedLength+T.packedLength+4+2}R.pack=function(e,r,t){if(!l(e))throw new L("value is required");if(!l(r))throw new L("array is required");t=_(t,0);var o,i=e._positions,f=i.length;for(r[t++]=f,o=0;o<f;++o,t+=v.packedLength)v.pack(i[o],r,t);var n=e._colors;for(f=l(n)?n.length:0,r[t++]=f,o=0;o<f;++o,t+=d.packedLength)d.pack(n[o],r,t);return w.pack(e._ellipsoid,r,t),t+=w.packedLength,T.pack(e._vertexFormat,r,t),t+=T.packedLength,r[t++]=e._width,r[t++]=e._colorsPerVertex?1:0,r[t++]=e._arcType,r[t++]=e._granularity,r[t++]=e._hMax,r[t++]=e._dist,r[t]=e._period,r};var be=w.clone(w.UNIT_SPHERE),Fe=new T,k={positions:void 0,colors:void 0,ellipsoid:be,vertexFormat:Fe,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};R.unpack=function(e,r,t){if(!l(e))throw new L("array is required");r=_(r,0);var o,i=e[r++],f=new Array(i);for(o=0;o<i;++o,r+=v.packedLength)f[o]=v.unpack(e,r);i=e[r++];var n=i>0?new Array(i):void 0;for(o=0;o<i;++o,r+=d.packedLength)n[o]=d.unpack(e,r);var O=w.unpack(e,r,be);r+=w.packedLength;var D=T.unpack(e,r,Fe);r+=T.packedLength;var E=e[r++],b=e[r++]===1,h=e[r++],a=e[r++],A=e[r++],p=e[r++]==1,c=e[r];return l(t)?(t._positions=f,t._colors=n,t._ellipsoid=w.clone(O,t._ellipsoid),t._vertexFormat=T.clone(D,t._vertexFormat),t._width=E,t._colorsPerVertex=b,t._arcType=h,t._granularity=a,t._hMax=A,t._dist=p,t._period=c,t):(k.positions=f,k.colors=n,k.width=E,k.colorsPerVertex=b,k.arcType=h,k.granularity=a,k.hMax=A,k.dist=p,k.period=c,new R(k))};var ke=new v,De=new v,ye=new v,Le=new v;R.createGeometry=function(e){var r=e._width,t=e._hMax,o=e._vertexFormat,i=e._colors,f=e._colorsPerVertex,n=e._arcType,O=e._granularity,D=e._ellipsoid,E=e._dist,b=e._period,h,a,A,p=Ae(e._positions,v.equalsEpsilon),c=p.length;if(c<2||r<=0)return;if(n===g.GEODESIC||n===g.RHUMB){var F,N;n===g.GEODESIC?(F=$.chordLength(O,D.maximumRadius),N=B.numberOfPoints):(F=O,N=B.numberOfPointsRhumbLine);var U=B.extractHeights(p,D);if(l(i)){var J=1;for(h=0;h<c-1;++h)J+=N(p[h],p[h+1],F);var G=new Array(J),K=0;for(h=0;h<c-1;++h){var I=p[h],ee=p[h+1],re=i[h],te=N(I,ee,F);if(f&&h<J){var Ve=i[h+1],ae=Re(I,ee,re,Ve,te),xe=ae.length;for(a=0;a<xe;++a)G[K++]=ae[a]}else for(a=0;a<te;++a)G[K++]=d.clone(re)}G[K]=d.clone(i[i.length-1]),i=G,ge.length=0}n===g.GEODESIC?p=B.generateCartesianArc({positions:p,minDistance:F,ellipsoid:D,height:U,hMax:t}):p=B.generateCartesianRhumbArc({positions:p,granularity:F,ellipsoid:D,height:U})}c=p.length;var y=c*4-4,oe=new Float64Array(y*3),ie=new Float64Array(y*3),ne=new Float64Array(y*3),C=new Float32Array(y*2),Q=o.st?new Float32Array(y*2):void 0,V=l(i)?new Uint8Array(y*4):void 0,q=E?new Float32Array(y*3):void 0,W=0,H=0,pe=0,Y=0,ce=0,s,X=0;for(a=0;a<c;++a){a===0?(s=ke,v.subtract(p[0],p[1],s),v.add(p[0],s,s)):s=p[a-1],v.clone(s,ye),v.clone(p[a],De),a===c-1?(s=ke,v.subtract(p[c-1],p[c-2],s),v.add(p[c-1],s,s)):s=p[a+1],v.clone(s,Le);var Z,fe;l(V)&&(a!==0&&!f?Z=i[a-1]:Z=i[a],a!==c-1&&(fe=i[a]));var Me=a===0?2:0,Se=a===c-1?2:4;for(A=Me;A<Se;++A){v.pack(De,oe,W),v.pack(ye,ie,W),v.pack(Le,ne,W),W+=3;var Oe=A-2<0?-1:1,ve=2*(A%2)-1,Ne=ve*a/c;if(t>0?C[H++]=Ne:C[H++]=ve,C[H++]=Oe*r,o.st&&(Q[pe++]=a/(c-1),Q[pe++]=Math.max(C[H-2],0)),l(V)){var j=A<2?Z:fe;V[Y++]=d.floatToByte(j.red),V[Y++]=d.floatToByte(j.green),V[Y++]=d.floatToByte(j.blue),V[Y++]=d.floatToByte(j.alpha)}E&&(q[ce*3]=X,ce++)}X+=v.distance(s,p[a])}if(E){var le=X,Be=Math.random()*(b>0?b:le);for(a=0;a<y;a++)q[a*3+1]=le,q[a*3+2]=Be}var x=new we;x.position=new S({componentDatatype:M.DOUBLE,componentsPerAttribute:3,values:oe}),x.prevPosition=new S({componentDatatype:M.DOUBLE,componentsPerAttribute:3,values:ie}),x.nextPosition=new S({componentDatatype:M.DOUBLE,componentsPerAttribute:3,values:ne}),x.expandAndWidth=new S({componentDatatype:M.FLOAT,componentsPerAttribute:2,values:C}),o.st&&(x.st=new S({componentDatatype:M.FLOAT,componentsPerAttribute:2,values:Q})),l(V)&&(x.color=new S({componentDatatype:M.UNSIGNED_BYTE,componentsPerAttribute:4,values:V,normalize:!0})),E&&(x.dist=new S({componentDatatype:M.FLOAT,componentsPerAttribute:3,values:q}));let he=c*6-6;c>2&&(he+=(c-2)*6);var m=Pe.createTypedArray(y,he),u=0,P=0,de=c-1;for(a=0;a<de;++a)m[P++]=u,m[P++]=u+2,m[P++]=u+1,m[P++]=u+1,m[P++]=u+2,m[P++]=u+3,c>2&&a!==de-1&&(m[P++]=u+3,m[P++]=u+5,m[P++]=u+4,m[P++]=u+2,m[P++]=u+5,m[P++]=u+4),u+=4;return new _e({attributes:x,indices:m,primitiveType:ue.TRIANGLES,boundingSphere:se.fromPoints(p),geometryType:me.POLYLINES})};var z=R;function Ue(e,r){return l(r)&&(e=z.unpack(e,r)),e._ellipsoid=w.clone(e._ellipsoid),z.createGeometry(e)}var sr=Ue;export{sr as default};
