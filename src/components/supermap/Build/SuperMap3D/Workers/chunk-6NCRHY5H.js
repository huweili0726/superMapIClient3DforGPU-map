import{a as K}from"./chunk-TAUHZ2AB.js";import{a as re}from"./chunk-DAQQE4FA.js";import{a as I}from"./chunk-SRPTWKHW.js";import{a as R}from"./chunk-EHDXVZQM.js";import{a as l}from"./chunk-DJQWO2NJ.js";import{a as P}from"./chunk-UBHQMGET.js";import{a as F}from"./chunk-EDZQSM3T.js";import{a as z}from"./chunk-PJGSCWXZ.js";import{a as d}from"./chunk-NUC3LT2W.js";function Fe(){return!0}function Pe(e,n){n=P(n,"This object was destroyed, i.e., destroy() was called.");function r(){throw new z(n)}for(var o in e)typeof e[o]=="function"&&(e[o]=r);e.isDestroyed=Fe}var j=Pe;var ne={STREAM_DRAW:R.STREAM_DRAW,STATIC_DRAW:R.STATIC_DRAW,DYNAMIC_DRAW:R.DYNAMIC_DRAW,validate:function(e){return e===ne.STREAM_DRAW||e===ne.STATIC_DRAW||e===ne.DYNAMIC_DRAW}},G=ne;var xe={Texture:0,Geometry:1};function Q(){this._memoryByType={}}Q.prototype.allocateGPUMemory=function(e,n){let r=this._memoryByType[e];r||(r=this._memoryByType[e]=0),r+=n,this._memoryByType[e]=r};Q.prototype.releaseGPUMemory=function(e,n){let r=this._memoryByType[e];r==null&&(r=this._memoryByType[e]=0),r-=n,r<0&&(console.log("memory cant less than 0."),r=0),this._memoryByType[e]=r};Q.prototype.reset=function(){this._memoryByType={}};function X(){this._owners={},this.show=!1}X.prototype.allocateGPUMemory=function(e,n,r){if(!this.show)return;let o=this._owners[n];o||(o=this._owners[n]=new Q),o.allocateGPUMemory(e,r)};X.prototype.releaseGPUMemory=function(e,n,r){if(!this.show)return;let o=this._owners[n];o||(o=this._owners[n]=new Q),o.releaseGPUMemory(e,r)};X.prototype.reset=function(){this._owners={}};X.prototype.isDestroyed=function(){return!1};X.prototype.destroy=function(){return j(this)};function q(e){if(e=P(e,P.EMPTY_OBJECT),F.defined("options.context",e.context),!d(e.typedArray)&&!d(e.sizeInBytes))throw new z("Either options.sizeInBytes or options.typedArray is required.");if(d(e.typedArray)&&d(e.sizeInBytes))throw new z("Cannot pass in both options.sizeInBytes and options.typedArray.");if(d(e.typedArray)&&(F.typeOf.object("options.typedArray",e.typedArray),F.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!G.validate(e.usage))throw new z("usage is invalid.");var n=e.context._gl,r=e.bufferTarget,o=e.typedArray,s=e.sizeInBytes,t=e.usage,i=d(o);i&&(s=o.byteLength),F.typeOf.number.greaterThan("sizeInBytes",s,0);var y=n.createBuffer();n.bindBuffer(r,y),n.bufferData(r,i?o:s,t),n.bindBuffer(r,null),this._gl=n,this._webgl2=e.context._webgl2,this._bufferTarget=r,this._sizeInBytes=s,this._usage=t,this._buffer=y,this.context=e.context,e.context.memorySize+=s,this._ownerName=e.owner,this.context.memoryAnalyzer.allocateGPUMemory(xe.Geometry,e.owner,s)}Object.defineProperties(q.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});q.prototype._getBuffer=function(){return this._buffer};q.prototype.copyFromArrayView=function(e,n){n=P(n,0),F.defined("arrayView",e),F.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",n+e.byteLength,this._sizeInBytes);var r=this._gl,o=this._bufferTarget;r.bindBuffer(o,this._buffer),r.bufferSubData(o,n,e),r.bindBuffer(o,null)};q.prototype.copyFromBuffer=function(e,n,r,o){if(!this._webgl2)throw new z("A WebGL 2 context is required.");if(!d(e))throw new z("readBuffer must be defined.");if(!d(o)||o<=0)throw new z("sizeInBytes must be defined and be greater than zero.");if(!d(n)||n<0||n+o>e.sizeInBytes)throw new z("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!d(r)||r<0||r+o>this._sizeInBytes)throw new z("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e.buffer&&(r>=n&&r<n+o||n>r&&n<r+o))throw new z("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===R.ELEMENT_ARRAY_BUFFER&&e.bufferTarget!==R.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==R.ELEMENT_ARRAY_BUFFER&&e.bufferTarget===R.ELEMENT_ARRAY_BUFFER)throw new z("Can not copy an index buffer into another buffer type.");var s=R.COPY_READ_BUFFER,t=R.COPY_WRITE_BUFFER,i=this._gl;i.bindBuffer(t,this._buffer),i.bindBuffer(s,e.buffer),i.copyBufferSubData(s,t,n,r,o),i.bindBuffer(t,null),i.bindBuffer(s,null)};q.prototype.getBufferData=function(e,n,r,o){if(n=P(n,0),r=P(r,0),!this._webgl2)throw new z("A WebGL 2 context is required.");if(!d(e))throw new z("arrayView is required.");var s,t,i=e.byteLength;if(d(o)?(s=o,d(i)?t=1:(i=e.length,t=e.BYTES_PER_ELEMENT)):d(i)?(s=i-r,t=1):(i=e.length,s=i-r,t=e.BYTES_PER_ELEMENT),r<0||r>i)throw new z("destinationOffset must be greater than zero and less than the arrayView length.");if(r+s>i)throw new z("destinationOffset + length must be less than or equal to the arrayViewLength.");if(n<0||n>this._sizeInBytes)throw new z("sourceOffset must be greater than zero and less than the buffers size.");if(n+s*t>this._sizeInBytes)throw new z("sourceOffset + length must be less than the buffers size.");var y=this._gl,f=R.COPY_READ_BUFFER;y.bindBuffer(f,this._buffer),y.getBufferSubData(f,n,e,r,o),y.bindBuffer(f,null)};q.prototype.isDestroyed=function(){return!1};q.prototype.destroy=function(){return!this.context._contextWasLost&&this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,this.context.memoryAnalyzer.releaseGPUMemory(xe.Geometry,this._ownerName,this.sizeInBytes),j(this)};var ve=q;function Me(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,r=e==="x"?n:n&3|8;return r.toString(16)})}var ge=Me;function M(e){if(e=P(e,P.EMPTY_OBJECT),F.defined("options.context",e.context),!d(e.typedArray)&&!d(e.sizeInBytes))throw new z("Either options.sizeInBytes or options.typedArray is required.");if(d(e.typedArray)&&d(e.sizeInBytes))throw new z("Cannot pass in both options.sizeInBytes and options.typedArray.");d(e.typedArray)&&(F.typeOf.object("options.typedArray",e.typedArray),F.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),this._id=ge(),e.context.webgpu?this._inner=new e.context.webgpuMembers.BufferGPU(e):this._inner=new ve(e),this.vertexArrayDestroyable=!0}M.createVertexBuffer=function(e){return F.defined("options.context",e.context),new M({context:e.context,bufferTarget:R.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,owner:e.owner})};M.createIndexBuffer=function(e){if(F.defined("options.context",e.context),!re.validate(e.indexDatatype))throw new z("Invalid indexDatatype.");if(e.indexDatatype===re.UNSIGNED_INT&&!e.context.elementIndexUint)throw new z("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var n=e.context,r=e.indexDatatype,o=re.getSizeInBytes(r),s=new M({context:n,bufferTarget:R.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage,indexDatatype:r,owner:e.owner}),t=s.sizeInBytes/o;return Object.defineProperties(s,{indexDatatype:{get:function(){return r}},bytesPerIndex:{get:function(){return o}},numberOfIndices:{get:function(){return t}}}),s};Object.defineProperties(M.prototype,{sizeInBytes:{get:function(){return this._inner.sizeInBytes}},usage:{get:function(){return this._inner.usage}},bufferTarget:{get:function(){return this._inner._bufferTarget}},buffer:{get:function(){return this._inner._buffer}}});M.prototype._getBuffer=function(){return this._inner._getBuffer()};M.prototype.copyFromArrayView=function(e,n){this._inner.copyFromArrayView(e,n)};M.prototype.copyFromBuffer=function(e,n,r,o){this._inner.copyFromBuffer(e,n,r,o)};M.prototype.getBufferData=function(e,n,r,o){this._inner.getBufferData(e,n,r,o)};M.prototype.isDestroyed=function(){return!1};M.prototype.destroy=function(){return this._inner.destroy(),j(this)};var _=M;var Ce=function(){var e=!![];return function(n,r){var o=e?function(){if(r){var s=r.apply(n,arguments);return r=null,s}}:function(){};return e=![],o}}(),pe=Ce(void 0,function(){return pe.toString().search("(((.+)+)+)+$").toString().constructor(pe).search("(((.+)+)+)+$")});pe();function he(){}he.computeNeighbors=function(e,n){for(var r=e.length/3,o=new Uint32Array(n+1),s=new Uint32Array(n+1),t=function(B,v){B<v?o[B+1]++:s[v+1]++},i=0;i<r;i++){var y=e[3*i],f=e[3*i+1],u=e[3*i+2];t(y,f),t(f,u),t(u,y)}for(i=f=y=0;i<n;i++)u=o[i+1],t=s[i+1],o[i+1]=y,s[i+1]=f,y+=u,f+=t;for(var a=new Uint32Array(6*r),p=o[n],t=function(D,g,T){if(D<g){var w=o[D+1]++;a[2*w]=g,a[2*w+1]=T}else w=s[g+1]++,a[2*p+2*w]=D,a[2*p+2*w+1]=T},i=0;i<r;i++)y=e[3*i],f=e[3*i+1],u=e[3*i+2],t(y,f,i),t(f,u,i),t(u,y,i);for(y=function(B,v){var D=2*B;for(B=v-B,v=1;v<B;v++){var g=a[D+2*v],T=a[D+2*v+1],w=v-1;for(w;0<=w&&a[D+2*w]>g;w--)a[D+2*w+2]=a[D+2*w],a[D+2*w+3]=a[D+2*w+1];a[D+2*w+2]=g,a[D+2*w+3]=T}},i=0;i<n;i++)y(o[i],o[i+1]),y(p+s[i],p+s[i+1]);for(var x=new Int32Array(3*r),h=function(g,T){return g===e[3*T]?0:g===e[3*T+1]?1:g===e[3*T+2]?2:-1},r=function(g,T){g=h(g,T),x[3*T+g]=-1},y=function(g,T,w,C){g=h(g,T),x[3*T+g]=C,w=h(w,C),x[3*C+w]=T},i=0;i<n;i++){for(var f=o[i],u=o[i+1],t=s[i],m=s[i+1];f<u&&t<m;){var c=a[2*f],A=a[2*p+2*t];c===A?(y(i,a[2*f+1],A,a[2*p+2*t+1]),f++,t++):c<A?(r(i,a[2*f+1]),f++):(r(A,a[2*p+2*t+1]),t++)}for(;f<u;)r(i,a[2*f+1]),f++;for(;t<m;)A=a[2*p+2*t],r(A,a[2*p+2*t+1]),t++}return x};function Ne(e){--e;for(var n=1;32>n;n<<=1)e|=e>>n;return e+1}var O=null;he.deduplicate=function(e,n,r,o,s){r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=e.byteLength/(4*n)),e=new Uint32Array(e,o,s*n),o=new Uint32Array(s);var t=Math.floor(1.1*s)+1;(O==null||O.length<2*t)&&(O=new Uint32Array(Ne(2*t)));for(var i=0;i<2*t;i++)O[i]=0;for(var y=0,f=r!==0?Math.ceil(7.84*1.96/(r*r)*r*(1-r)):s,i=0;i<s;i++){if(i===f){var u=1-y/i;if(u+1.96*Math.sqrt(u*(1-u)/i)<r)return null;f*=2}for(var u=i*n,a,p=a=0;p<n;p++)a=e[u+p]+a|0,a=a+(a<<11)+(a>>>2)|0;a>>>=0;for(var p=a%t,x=y;O[2*p+1]!==0;){if(O[2*p]===a){var h=O[2*p+1]-1,m=h*n;e:{for(var c=0;c<n;c++)if(e[u+c]!==e[m+c]){m=!1;break e}m=!0}if(m){x=o[h];break}}p++,p>=t&&(p-=t)}x===y&&(O[2*p]=a,O[2*p+1]=i+1,y++),o[i]=x}if(r!==0&&1-y/s<r)return null;for(r=new Uint32Array(n*y),i=y=0;i<s;i++)if(o[i]===y){for(t=e,f=i*n,u=r,a=y*n,p=n,x=0;x<p;x++)u[a+x]=t[f+x];y++}return{buffer:r.buffer,indices:o,uniqueCount:y}};var ie=he;function Ie(){}function Oe(e){return Math.acos(1<e?1:-1>e?-1:e)}function ze(e){var n=function(){var o=!![];return function(s,t){var i=o?function(){if(t){var y=t.apply(s,arguments);return t=null,y}}:function(){};return o=![],i}}(),r=n(this,function(){return r.toString().search("(((.+)+)+)+$").toString().constructor(r).search("(((.+)+)+)+$")});return r(),e*Math.PI/180}var Ue=4,Ve=35,be=ze(Ue),qe=ze(Ve),Ge=Math.cos(qe),We=Math.cos(be);function Ye(e,n,r){var o=r.x-n.x,s=r.y-n.y;return n=r.z-n.z,r=o*o+s*s+n*n,r?(r=1/Math.sqrt(r),e.x=o*r,e.y=s*r,e.z=n*r,e):(e.x=0,e.y=0,e.z=0,e)}var ke={position0:new l,position1:new l,faceNormal0:new l,faceNormal1:new l,cosAngle:0},Be=new l,we=new l;function je(e,n){var r=Oe(e.cosAngle);Ye(we,e.position1,e.position0),l.cross(e.faceNormal0,e.faceNormal1,Be);var o=0<l.dot(Be,we)?-1:1;return r*o>n}function $e(e){var n=e.faces.length/3,r=e.faces,o=e.neighbors,s=0,t=0;for(t=0;t<n;t++){var i=o[3*t+0],y=o[3*t+1],f=o[3*t+2],u=r[3*t+0],a=r[3*t+1],p=r[3*t+2];s=s+(i===-1||u<a?1:0),s=s+(y===-1||a<p?1:0),s=s+(f===-1||p<u?1:0)}var x=new Int32Array(4*s),h=0;for(t=0;t<n;t++){var i=o[3*t+0],y=o[3*t+1],f=o[3*t+2],u=r[3*t+0],a=r[3*t+1],p=r[3*t+2];(i===-1||u<a)&&(x[h++]=u,x[h++]=a,x[h++]=t,x[h++]=i),(y===-1||a<p)&&(x[h++]=a,x[h++]=p,x[h++]=t,x[h++]=y),(f===-1||p<u)&&(x[h++]=p,x[h++]=u,x[h++]=t,x[h++]=f)}return x}var N=new l,$=new l,Z=new l;function Ze(e){var n=e.x*e.x+e.y*e.y+e.z*e.z;n>0&&(n=1/Math.sqrt(n),e.x*=n,e.y*=n,e.z*=n)}function Je(e){for(var n=e.faces.length/3,r=e.vertices,o=e.dim,s=e.faces,t=new Float32Array(3*n),i=0;i<n;i++){var y=s[3*i+0],f=s[3*i+1],u=s[3*i+2];N.x=r[o*y],N.y=r[o*y+1],N.z=r[o*y+2],$.x=r[o*f],$.y=r[o*f+1],$.z=r[o*f+2],Z.x=r[o*u],Z.y=r[o*u+1],Z.z=r[o*u+2],l.subtract($,N,$),l.subtract(Z,N,Z),l.cross($,Z,N),Ze(N),t[3*i+0]=N.x,t[3*i+1]=N.y,t[3*i+2]=N.z}return t}function He(e,n){n===0&&(n=e,e=0);for(var r=Array(n-e),o=e;o<n;o++)r[o-e]=o;return r}Ie.extractEdges=function(e,n){var r=e.vertices,o=e.dim,s=d(n),t=ke,i=t.position0,y=t.position1,f=t.faceNormal0,u=t.faceNormal1,a=Je(e),p=$e(e),x=p.length/4,h=new Float32Array(10*x),m=0,c=new Float32Array(13*x),A=0,B=0,v=0,D=He(0,x),g=new Float32Array(x);g.forEach(function(de,H,Re){var fe=p[4*H+0],ye=p[4*H+1];i.x=r[fe*o],i.y=r[fe*o+1],i.z=r[fe*o+2],y.x=r[ye*o],y.y=r[ye*o+1],y.z=r[ye*o+2],Re[H]=l.distance(i,y)}),D.sort(function(de,H){return g[H]-g[de]});for(var T=[],w=[],C=0;C<x;C++){var V=D[C],Y=g[V],ee=p[4*V+0],se=p[4*V+1],k=p[4*V+2],te=p[4*V+3],ce=te===-1;i.x=r[ee*o],i.y=r[ee*o+1],i.z=r[ee*o+2],y.x=r[se*o],y.y=r[se*o+1],y.z=r[se*o+2];var ae=-1;if(s&&(ae=n[ee]),ce)f.x=a[3*k],f.y=a[3*k+1],f.z=a[3*k+2],u.x=f.x,u.y=f.y,u.z=f.z,t.cosAngle=l.dot(f,u);else if(f.x=a[3*k],f.y=a[3*k+1],f.z=a[3*k+2],u.x=a[3*te],u.y=a[3*te+1],u.z=a[3*te+2],t.cosAngle=l.dot(f,u),t.cosAngle>We)continue;B+=Y,v++,ce||t.cosAngle<Ge?(h[m++]=t.position0.x,h[m++]=t.position0.y,h[m++]=t.position0.z,h[m++]=t.position1.x,h[m++]=t.position1.y,h[m++]=t.position1.z,h[m++]=t.faceNormal0.x,h[m++]=t.faceNormal0.y,h[m++]=t.faceNormal0.z,h[m++]=ae,T.push(Y)):je(t,be)&&(c[A++]=t.position0.x,c[A++]=t.position0.y,c[A++]=t.position0.z,c[A++]=t.position1.x,c[A++]=t.position1.y,c[A++]=t.position1.z,c[A++]=t.faceNormal0.x,c[A++]=t.faceNormal0.y,c[A++]=t.faceNormal0.z,c[A++]=t.faceNormal1.x,c[A++]=t.faceNormal1.y,c[A++]=t.faceNormal1.z,c[A++]=ae,w.push(Y))}h=h.slice(0,m),c=c.slice(0,A);var ue=B/v,le=T.length,Ae=w.length;return{regular:{instancesData:h,instanceCount:le,edgeLength:le*ue},silhouette:{instancesData:c,instanceCount:Ae,edgeLength:Ae*ue},averageEdgeLength:ue}};var De=Ie;var Ke=function(){var e=!![];return function(n,r){var o=e?function(){if(r){var s=r.apply(n,arguments);return r=null,s}}:function(){};return e=![],o}}(),me=Ke(void 0,function(){return me.toString().search("(((.+)+)+)+$").toString().constructor(me).search("(((.+)+)+)+$")});me();function S(e){}S.RegularInstanceStride=12,S.SilhouetteInstanceStride=15,S.createEdgeData=function(e,n,i,o){if(n.length==0)return null;var s=n[0],t;s.indexType===0?t=new Uint16Array(s.indicesTypedArray.buffer,s.indicesTypedArray.byteOffset,s.indicesTypedArray.byteLength/2):t=new Uint32Array(s.indicesTypedArray.buffer,s.indicesTypedArray.byteOffset,s.indicesTypedArray.byteLength/4);var i=P(i,![]),y=S.extractEdgeInformation(e,i,t),f=e.attrLocation.batchId,u=null;f&&(u=e.vertexAttributes[f].typedArray);var a=De.extractEdges(y,u);return d(o)&&(d(a.regular.instancesData)&&o.push(a.regular.instancesData.buffer),d(a.silhouette.instancesData)&&o.push(a.silhouette.instancesData.buffer)),a},S.createIndexBuffer=function(e,n){return e.createSidenessIndexBuffer()};function Te(e,n,r,o,s,t){e.aInstanceMatrixRow0=r++,n.push({name:"aInstanceMatrixRow0",index:e.aInstanceMatrixRow0,vertexBuffer:o,componentsPerAttribute:4,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:t,instanceDivisor:s}),e.aInstanceMatrixRow1=r++,n.push({name:"aInstanceMatrixRow1",index:e.aInstanceMatrixRow1,vertexBuffer:o,componentsPerAttribute:4,componentDatatype:I.FLOAT,offsetInBytes:16,strideInBytes:t,instanceDivisor:s}),e.aInstanceMatrixRow2=r++,n.push({name:"aInstanceMatrixRow2",index:e.aInstanceMatrixRow2,vertexBuffer:o,componentsPerAttribute:4,componentDatatype:I.FLOAT,offsetInBytes:32,strideInBytes:t,instanceDivisor:s})}S.createRegularEdgeAttributes=function(e,n,r,o,s){if(!d(n.instancesData)||n.instancesData.length==0)return;var t={},i=[];n.attributeLocations=t,n.attributes=i;let y=n.instancesData,f;if(d(s)&&s.instanceCount>0){let c=y.length,A=new Float32Array(c*s.instanceCount);for(let B=0,v=s.instanceCount;B<v;B++)A.set(y,B*c);y=A,f=_.createVertexBuffer({context:e,typedArray:s.instanceBuffer,usage:G.STATIC_DRAW,owner:o})}var u=_.createVertexBuffer({context:e,typedArray:y,usage:G.STATIC_DRAW,owner:o}),a=I.getSizeInBytes(I.FLOAT),p=e.createSidenessVertexBuffer(),x=0;t.aSideness=x++,i.push({name:"aSideness",index:t.aSideness,vertexBuffer:p,componentsPerAttribute:2,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:I.getSizeInBytes(I.FLOAT)*2,normalize:![]});var h=r||S.RegularInstanceStride,m=0;if(t.aPosition0=x++,i.push({name:"aPosition0",index:t.aPosition0,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:a*m,strideInBytes:a*h,instanceDivisor:1}),m+=3,t.aPosition1=x++,i.push({name:"aPosition1",index:t.aPosition1,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:a*m,strideInBytes:a*h,instanceDivisor:1}),m+=3,t.aNormal=x++,i.push({name:"aNormal",index:t.aNormal,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:a*m,strideInBytes:a*h,instanceDivisor:1}),m+=3,t.batchId=x++,i.push({name:"batchId",index:t.batchId,vertexBuffer:u,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:a*m,strideInBytes:a*h,instanceDivisor:1}),m+=1,t.aVariantStroke=x++,i.push({name:"aVariantStroke",index:t.aVariantStroke,vertexBuffer:u,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:a*m,strideInBytes:a*h,instanceDivisor:1}),m+=1,t.aVariantExtension=x++,i.push({name:"aVariantExtension",index:t.aVariantExtension,vertexBuffer:u,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:a*m,strideInBytes:a*h,instanceDivisor:1}),m+=1,d(s)&&s.instanceCount>0){let c=Float32Array.BYTES_PER_ELEMENT*s.instanceMode;Te(t,i,x,f,n.instanceCount,c)}},S.createSilhouetteEdgeAttributes=function(e,n,r,o){if(!d(n.instancesData)||n.instancesData.length==0)return;var s={},t=[];n.attributeLocations=s,n.attributes=t;let i,y=n.instancesData;if(d(o)&&o.instanceCount>0){let h=y.length,m=new Float32Array(h*o.instanceCount);for(let c=0,A=o.instanceCount;c<A;c++)m.set(y,c*h);y=m,i=_.createVertexBuffer({context:e,typedArray:o.instanceBuffer,usage:G.STATIC_DRAW,owner:r})}var f=_.createVertexBuffer({context:e,typedArray:y,usage:G.STATIC_DRAW,owner:r}),u=I.getSizeInBytes(I.FLOAT),a=0;s.aSideness=a++,t.push({name:"aSideness",index:s.aSideness,vertexBuffer:e.createSidenessVertexBuffer(),componentsPerAttribute:2,componentDatatype:I.FLOAT,offsetInBytes:0,strideInBytes:u*2,normalize:![]});var p=S.SilhouetteInstanceStride,x=0;if(s.aPosition0=a++,t.push({name:"aPosition0",index:s.aPosition0,vertexBuffer:f,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=3,s.aPosition1=a++,t.push({name:"aPosition1",index:s.aPosition1,vertexBuffer:f,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=3,s.aNormalA=a++,t.push({name:"aNormalA",index:s.aNormalA,vertexBuffer:f,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=3,s.aNormalB=a++,t.push({name:"aNormalB",index:s.aNormalB,vertexBuffer:f,componentsPerAttribute:3,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=3,s.batchId=a++,t.push({name:"batchId",index:s.batchId,vertexBuffer:f,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=1,s.aVariantStroke=a++,t.push({name:"aVariantStroke",index:s.aVariantStroke,vertexBuffer:f,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=1,s.aVariantExtension=a++,t.push({name:"aVariantExtension",index:s.aVariantExtension,vertexBuffer:f,componentsPerAttribute:1,componentDatatype:I.FLOAT,normalize:!![],offsetInBytes:u*x,strideInBytes:u*p,instanceDivisor:1}),x+=1,d(o)&&o.instanceCount>0){let h=Float32Array.BYTES_PER_ELEMENT*o.instanceMode;Te(s,t,a,i,n.instanceCount,h)}};function Se(e,n){for(var r=n.componentsPerAttribute,o=e.vertCompressConstant,s=new l(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),t=new Uint16Array(n.typedArray.buffer,n.typedArray.byteOffset,n.typedArray.byteLength/2),i=new Float32Array(e.verticesCount*3),y,f,u,a=0;a<e.verticesCount;a++)y=t[r*a]*o+s.x,f=t[r*a+1]*o+s.y,u=t[r*a+2]*o+s.z,i[3*a]=y,i[3*a+1]=f,i[3*a+2]=u;return i}S.extractEdgeInformation=function(e,n,r){var o=e.attrLocation.aPosition,s=e.vertexAttributes[o],t=d(e.nCompressOptions)&&(e.nCompressOptions&K.SVC_Vertex)===K.SVC_Vertex,i=s.componentsPerAttribute,y;t?(i=3,y=Se(e,s)):y=new Float32Array(s.typedArray.buffer,s.typedArray.byteOffset,s.typedArray.byteLength/4);var f=y.length/i;if(n&&r){var u=ie.computeNeighbors(r,f);return{faces:r,neighbors:u,vertices:y,dim:i}}var a=s.typedArray.buffer,p;t?p=y.buffer:p=a.slice(s.typedArray.byteOffset,s.typedArray.byteOffset+s.typedArray.byteLength);var x=ie.deduplicate(p,i),h=S.selectIndexData(x.indices,r),m=ie.computeNeighbors(h,x.uniqueCount),c=new Float32Array(x.buffer);return{faces:h,neighbors:m,vertices:c,dim:i}},S.selectIndexData=function(e,n){if(n){n=n.slice();for(var r=0;r<n.length;r++)n[r]=e[n[r]];return n}return e};var b=new l,E=new l,W=new l,J=new l,L=new l,oe=new l,U=new l,Ee=new l;S.createEdgeDataByIndices=function(e,n){var r=e.attrLocation.aPosition,o=e.vertexAttributes[r],s=d(e.nCompressOptions)&&(e.nCompressOptions&K.SVC_Vertex)===K.SVC_Vertex,t=o.componentsPerAttribute,i;s?(t=3,i=Se(e,o)):i=new Float32Array(o.typedArray.buffer,o.typedArray.byteOffset,o.typedArray.byteLength/4);var y;n.indexType===0?y=new Uint16Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/2):y=new Uint32Array(n.indicesTypedArray.buffer,n.indicesTypedArray.byteOffset,n.indicesTypedArray.byteLength/4);for(var f=[],u=[],a=y.length,p=0,x=0,h=Math.floor(a/4)*4;x<h;x+=4){var m=y[x],c=y[x+1],A=y[x+2],B=y[x+3];if(b.x=i[t*m],b.y=i[t*m+1],b.z=i[t*m+2],E.x=i[t*c],E.y=i[t*c+1],E.z=i[t*c+2],W.x=i[t*A],W.y=i[t*A+1],W.z=i[t*A+2],J.x=i[t*B],J.y=i[t*B+1],J.z=i[t*B+2],!(l.equals(E,W)||l.equals(E,J)||l.equals(E,b)||l.equals(W,b)||l.equals(J,b))){if(A===B){if(l.subtract(E,b,L),l.subtract(W,b,oe),l.cross(L,oe,L),l.equals(L,l.ZERO))continue;l.normalize(L,L),f.push(b.x),f.push(b.y),f.push(b.z),f.push(E.x),f.push(E.y),f.push(E.z),f.push(L.x),f.push(L.y),f.push(L.z),f.push(m);var v=Le(b,E),D=v.variantStroke,g=v.variantExtension;f.push(D),f.push(g)}else{if(l.subtract(E,b,L),l.subtract(W,b,oe),l.cross(L,oe,L),l.equals(L,l.ZERO)||(l.normalize(L,L),l.subtract(E,b,U),l.subtract(J,b,Ee),l.cross(Ee,U,U),l.equals(U,l.ZERO)))continue;l.normalize(U,U),u.push(b.x),u.push(b.y),u.push(b.z),u.push(E.x),u.push(E.y),u.push(E.z),u.push(L.x),u.push(L.y),u.push(L.z),u.push(U.x),u.push(U.y),u.push(U.z),u.push(m);var v=Le(b,E),D=v.variantStroke,g=v.variantExtension;u.push(D),u.push(g)}var T=l.distance(b,E);p+=T}}var w=a/4,C=p/w,V=f.length/S.RegularInstanceStride,Y=u.length/S.SilhouetteInstanceStride;return{regular:{instancesData:new Float32Array(f),instanceCount:V,edgeLength:V*C},silhouette:{instancesData:new Float32Array(u),instanceCount:Y,edgeLength:Y},averageEdgeLength:C}};function Le(e,n){function r(h,m){var c=new Float32Array(6),A=new Uint32Array(c.buffer),B=new Uint32Array(1);c[0]=h.x,c[1]=h.y,c[2]=h.z,c[3]=m.x,c[4]=m.y,c[5]=m.z,B[0]=5381;for(var v=0;v<A.length;v++)B[0]=31*B[0]+A[v];return B[0]}function o(h,m,c){c-=m;var A=48217*h%2147483647,B=A/2147483647,v=m+B*c;return{seed:A,result:Math.round(v)}}function s(h){var m=48217*h%2147483647,c=m/(2147483647-1);return{seed:m,result:c}}var t=r(e,n);!d(t)&&(t=Math.random()*2147483647);var i=o(t,0,255);t=i.seed;var y=i.result;i=o(t,0,5),t=i.seed;var f=i.result;i=s(t),t=i.seed;var u=i.result;u=-(1-Math.min(u/.7,1))+Math.max(0,u-.7)/(1-.7),u=255*(Math.abs(u)**1.2*(0>u?-1:1)*.5+.5);var a=y,p=f,x=u;return{variantStroke:p,variantExtension:x}}var Ot=S;export{Ot as a};
