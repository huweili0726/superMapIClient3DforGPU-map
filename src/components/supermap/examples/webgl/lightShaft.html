<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title>光束效果</title>
    <link href="../../Build/SuperMap3D/Widgets/widgets.css" rel="stylesheet">
    <link href="./css/pretty.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <script src="./js/jquery.min.js"></script>
    <script src="./js/config.js"></script>
    <script type="text/javascript" src="../../Build/SuperMap3D/SuperMap3D.js"></script>
</head>

<body>
    <div id="Container"></div>
    <div id="toolbar" class="param-container tool-bar" style="padding: 5px 10px; width: 120px;">
        <div class="param-item inputBox" style="margin: 0px;">
            <span class="titl" style="margin-top: 5px;">开启</span>
            <input type="checkbox" checked id="tyndall">
        </div>
    </div>

    <div id='loadingbar' class="spinner">
        <div class="spinner-container container1">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container2">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
        <div class="spinner-container container3">
            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
            <div class="circle4"></div>
        </div>
    </div>
    <script>
        function onload(SuperMap3D) {
            const EngineType = getEngineType();
            const viewer = new SuperMap3D.Viewer('Container', {
                contextOptions: {
                    contextType: Number(EngineType), // Webgl2:2 ; WebGPU:3
                },
                timeline: true
            });
            window.viewer = viewer;
            viewer.scenePromise.then(function (scene) {
                init(SuperMap3D, scene, viewer);
            });
        }

        function init(SuperMap3D, scene, viewer) {
            viewer.resolutionScale = window.devicePixelRatio;

            // 添加必应地图
            // 加载高德影像地图
            viewer.imageryLayers.addImageryProvider(new SuperMap3D.UrlTemplateImageryProvider({
                url: 'https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}',
                minimumLevel: 3,
                maximumLevel: 18,
            }));


             // 因为日光很亮, 建议打开HDR效果
            scene.hdrEnabled = true;

            // 雾气效果
            scene.fog.enabled = true;
            scene.fog.heightFalloff = 0.1;

            // 丁达尔效应开启接口
            scene.postProcessStages.lightShaft.enabled = true;

            // 设置时间：丁达尔效应常出现于清晨、日落
            const time = SuperMap3D.JulianDate.fromIso8601('2025-04-14T22:14:01.41501564129430335Z')
            viewer.clock.currentTime = time.clone();

            // 打开场景
            const promise = scene.open(URL_CONFIG.SCENE_CBD)
            promise.then(function (layers) {
                $('#loadingbar').remove();

                scene.camera.setView({
                    destination: new SuperMap3D.Cartesian3(-2181311.692013047, 4386615.148870063, 4070583.4526216155),
                    orientation: {
                        heading: 1.5628543758427744,
                        pitch: 0.028640358057069992,
                        roll: 7.784426436785452e-9
                    }
                });
            })


            $("#tyndall").on("input change", function () {
                scene.postProcessStages.lightShaft.enabled = this.checked;
            });
        }
        if (typeof SuperMap3D !== 'undefined') {
            window.startupCalled = true;
            onload(SuperMap3D);
        }
    </script>
</body>

</html>