<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Test">
    <meta name="Cesium-sandcastle-labels" content="Geometries">
    <title>SuperMap 标牌</title>

    <link rel="stylesheet" href="./css/sideBar.css">

    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" media="screen,projection" href="css/jquery-sticklr.css" />
    <link href="./css/pretty.css" rel="stylesheet">
    <link href="./css/font-awesome.min.css" rel="stylesheet">
    <script src="js/plotPanelControl/PlottingUI.Include.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="./js/bootstrap-select.min.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/spectrum.js"></script>
    <script src="./js/tooltip.js"></script>
    <link href="css/bootstrap-new.min.css" rel="stylesheet">
    <script type="text/javascript" include="bootstrap-css,responsive,colorpicker"
        src="js/jquery.colorpicker.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="js/widgets.js"></script>
    <script type="text/javascript" src="../../Build/SuperMap3D/SuperMap3D.js"></script>
    <link href="../../Build/SuperMap3D/Widgets/widgets.css" rel="stylesheet">
    <script type="text/javascript" src="../../Build/SuperMap3D/ThirdParty/Workers/MGIS_SuperMap3D/MGIS_SuperMap3D.js"></script>
</head>

<body style=" margin: 0;background: #fff;width: 100%;height:100%;position: absolute;top: 0;">
    <div id="toolbar" class="param-container tool-bar">
        <div class='param-item'>
            <button class="button black mButton" id="createBatchSign" name="isSolid" value="Solid"
                onclick="addSignByGeo()">添加到标绘</input>
                <button class="button black mButton" id="createBatchSign" name="isSolid" value="Solid"
                    onclick="addSignByPosition()">添加到场景</input>
        </div>
        <div class="title"></div>
        <div class='param-item'>
            <input type="radio" id="Billboard" name="signRenderModeRadio" value="0"
                checked="checked">图片模式</input>&nbsp;&nbsp;
            <input type="radio" id="DOM" name="signRenderModeRadio" value="1">DOM模式</input>&nbsp;&nbsp;
            <input type="radio" id="Solid" name="signRenderModeRadio" value="2">立体模式</input>
        </div>
        <div class='param-item'>
            <select class="search-query from-control" id="signEffectType"
                style="width: 180px;height: 25px; margin-bottom: 0;">
                <option value="0">sign1_blue</option>
                <option value="1">sign2_Red</option>
                <option value="2">sign3_图片背景</option>
                <option value="3">sign4_多行文字1</option>
                <option value="4">sign5_多行文字2</option>
                <option value="5">sign6_多行文字_无边框</option>
                <option value="6">sign7_图片背景1</option>
                <option value="7">sign8_图片背景2</option>
                <option value="8">sign9_图片背景3</option>
                <option value="9">sign10_图片背景4</option>
                <option value="10">sign11_图片背景5</option>
                <option value="11">sign12_图片背景6</option>
                <option value="12">sign13_blue_虚线</option>
                <option value="13">sign14_blue_渐变色背景</option>
            </select>&nbsp;&nbsp;
            <!-- <input type="button" style="color:black" value="删除" onclick=" delectSignEffect()" /> &nbsp;&nbsp; -->
        </div>
        <div class='param-item'>
            <input type="checkbox" id="DOM" name="signIsAvoidance" value="1"
                onchange="setSignIsAvoidance(this)">开启避让</input>
        </div>

    </div>

    <div id="SuperMap3DContainer" class="fullSize" style="position: absolute;width: 100%;height: 100%;">
        <script id="SuperMap3D_sandcastle_script">
            var plottingLayer;
            var scene;

            var symbolLibManager;
            var animationManager = null;
            var sitDataManager;
            var btn = false;
            var libID;
            var geo = null;
            var isAlgo = false;
            var campos;
            var viewer;

            var plotEditControl;
            var plotDrawControl;
            var plottingLayers = [];

            var wayPts = [];
            var names = [];
            var allImage;
            var mGISManager;

            function delectSignEffect() {
                if (geo) {
                    geo.removeAllGeoEffect();
                }
            }

            function addSignByPosition() {
                let signLayer = mGISManager.effectLayers.signLayer;
                let arySigns = signLayer.getAllSigns();
                for (let i = 0; i < arySigns.length; i++) {
                    signLayer.remove(arySigns[i]);
                }

                mGISManager.effectLayers.signLayer.canDrag = true;

                var signRenderModeRadio = document.getElementsByName("signRenderModeRadio");
                var signRenderMode = -1;
                for (var i = 0; i < signRenderModeRadio.length; i++) {
                    if (signRenderModeRadio[i].checked) {
                        signRenderMode = parseInt(signRenderModeRadio[i].value);
                        break;
                    }
                }
                
                let signEffectElement = document.getElementById("signEffectType");
                let signEffectType = parseInt(signEffectElement.value);

                let sign = new SuperMap3D.Sign({
                            signParmMode: SuperMap3D.SignParmMode.Complex,
                            signEffectType: signEffectType,
                            signRenderMode: signRenderMode,
                            position: new SuperMap3D.MPoint3D(116.45581060350803, 39.90767353257565, 20.28090774482578),
                            texts:["独立的标牌", "经度：116.46", "纬度： 39.91"],
                            solidRotation: new SuperMap3D.PlotPoint3D(0, 0, 180)
                        });
                        mGISManager.effectLayers.signLayer.add(sign);
                        sign.setVisible(true);


            }

            function addSignByGeo() {
                delectSignEffect();

                var signRenderModeRadio = document.getElementsByName("signRenderModeRadio");
                var signRenderMode = -1;
                for (var i = 0; i < signRenderModeRadio.length; i++) {
                    if (signRenderModeRadio[i].checked) {
                        signRenderMode = parseInt(signRenderModeRadio[i].value);
                        break;
                    }
                }

                let signEffectElement = document.getElementById("signEffectType");
                let signEffectType = parseInt(signEffectElement.value);

                let opt = {};
                opt.scene = viewer.scene;
                opt.signEffectType = signEffectType;
                opt.signRenderMode = signRenderMode;
                opt.signParmMode = 1;//复杂标牌
                opt.title = "标题";
                opt.texts = ["文字内容1", "文字内容2"];
                opt.pntOffset3D = new SuperMap3D.PlotPoint3D(0, -0.1, 0.8);

                let signEffect = new SuperMap3D.Sign(opt);
                geo.addGeoEffect(signEffect);

                signEffect.setVisible(true);
            }

            function setSignIsAvoidance(checkbox) {
                mGISManager.property.isSignAutoAvoidance = checkbox.checked;
            }

            function onload(MGIS_SuperMap3D) {
                'use strict';
                if (window.Cesium) {
                    window.SuperMap3D = MGIS_SuperMap3D;
                }

                var host = window.isLocalPlot ? window.plotServer : "http://support.supermap.com.cn:8090";
                var serverUrl = host + '/iserver/services/plot-jingyong/rest/plot';
                viewer = new SuperMap3D.Viewer('SuperMap3DContainer');
                scene = viewer.scene;
                let CBD = host + "/iserver/services/3D-CBD/rest/realspace";
                let BIMBuilding = host + "/iserver/services/3D-BIMBuilding/rest/realspace";
                var promise = scene.open(CBD);
                plottingLayer = new SuperMap3D.PlottingLayer(scene, "SupermapPlottingLayer");
                scene.plotLayers.add(plottingLayer);
                scene.globe.depthTestAgainstTerrain = false;
                // scene.globe.depthTestAgainstTerrain = true;
                scene.globe.enableLighting = false;//阳光照射区域高亮

                mGISManager = new SuperMap3D.MGISManager({ scene: scene, serverUrl:  serverUrl});
                mGISManager.property.signAvoidanceAngles = [30, 60, 120, 150];

                InitPlot(viewer, serverUrl);
                createGeographicObject();

                // viewer.camera.flyTo({
                //     destination: new SuperMap3D.Cartesian3(-2182652.9149541846, 4386250.412634591, 4070148.619404614),
                //     orientation: {
                //         heading: 3.135983939750009,
                //         pitch: -0.07713076377377304,
                //         roll: 3.843992679719577e-9
                //     }
                // });
            }

            function createGeographicObject() {
                createModel({
                    modelPath: './SampleData/situationSimulation/Model/T90-redV1.gltf',// 模型路径
                    position: new SuperMap3D.PlotPoint3D(116.45551060350803, 39.90767353257565, 20.28090774482578), // 模型位置点
                    modelRotate: new SuperMap3D.PlotPoint3D(0, 0, 180),// 模型旋转
                    modelScale: 2, // 模型缩放比例
                    display: true,
                    id: "people_8001"
                }, geo => geoTerroristLeaderRight2 = geo)
            }

            function createModel(options, callback) {

                var modelUrl = { url: options.modelPath }
                plottingLayer.createSymbol(0, 99999, [options.position], modelUrl, function (even) {
                    if (even.feature) {
                        geo = even.feature;
                        geo.modelScale = options.modelScale || 1;
                        geo.modelRotate = options.modelRotate || new SuperMap3D.PlotPoint3D(0, 0, 0);
                        geo.display = (options.display || false);
                        if (options.id) {
                            geo.id = options.id;
                        }

                        if (options.textContent) {
                            geo.textContent = options.textContent;
                            let textColor = new SuperMap3D.Color(1, 1, 1, 1);
                            geo.symbolTextStyle.foreColor = options.color || textColor;
                            geo.symbolTextStyle.bold = true;
                            geo.symbolTextStyle.outline = true;
                            geo.symbolTextStyle.outlineColor = new SuperMap3D.Color(0, 0, 0, 1);
                        }

                        var animation = null;
                        if (options.isCreateAnimation) {
                            options.animationGeo = geo;
                            animation = createPathAnimation(options);
                        }
                        if (typeof callback === 'function') {
                            callback(geo, animation);
                        }
                    }

                });
            }

            if (typeof MGIS_SuperMap3D !== 'undefined') {
                window.startupCalled = true;
                onload(MGIS_SuperMap3D);
            }

            function InitPlot(viewer, serverUrl) {
                if (!viewer) {
                    return;
                }

                plotting = SuperMap3D.Plotting.getInstance(serverUrl, scene);
                plotEditControl = new SuperMap3D.PlotEditControl(scene, plottingLayer);//编辑控件
                plotEditControl.activate();
                plotEditControl.FeatureDragEvent.addEventListener(function (a, b, c) {
                    console.log(a, b, c);
                });
                plotDrawControl = new SuperMap3D.PlotDrawControl(scene, plottingLayer);//绘制控件
                plotDrawControl.drawFinishEvent.addEventListener(function () {//标绘结束，激活编辑控件
                    plotEditControl.activate();
                });

            }
        </script>
    </div>
</body>

</html>